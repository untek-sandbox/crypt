var liner=function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t,r){return(v=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&f(i,r.prototype),i}).apply(null,arguments)}function y(e){var t="function"==typeof Map?new Map:void 0;return(y=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return v(e,arguments,h(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),f(n,e)})(e)}function p(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e,t,r){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function m(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var d,k,w={};"undefined"!=typeof self&&(w=self),e.nativeCrypto=w.msCrypto||w.crypto||{},e.nativeSubtle=null;try{e.nativeSubtle=(null===(d=e.nativeCrypto)||void 0===d?void 0:d.subtle)||(null===(k=e.nativeCrypto)||void 0===k?void 0:k.webkitSubtle)||null}catch(e){console.warn("Cannot get subtle from crypto",e)}function b(e){return"undefined"!=typeof Buffer&&Buffer.isBuffer(e)?new Uint8Array(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var B=function(){function e(){i(this,e)}return o(e,null,[{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=b(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"ToBase64",value:function(e){var t=b(e);if("undefined"!=typeof btoa){var r=this.ToString(t,"binary");return btoa(r)}return Buffer.from(t).toString("base64")}},{key:"FromBase64",value:function(e){return e=e.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"").replace(/\s/g,""),"undefined"!=typeof atob?this.FromBinary(atob(e)):new Uint8Array(Buffer.from(e,"base64")).buffer}},{key:"FromBase64Url",value:function(e){return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r.buffer}},{key:"ToUtf8String",value:function(e){var t=b(e),r=String.fromCharCode.apply(null,t);return decodeURIComponent(escape(r))}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}},{key:"ToBinary",value:function(e){for(var t=b(e),r="",n=t.length,i=0;i<n;i++)r+=String.fromCharCode(t[i]);return r}},{key:"ToHex",value:function(e){for(var t=b(e),r=[],n=t.length,i=0;i<n;i++){var a=t[i].toString(16);r.push(1===a.length?"0"+a:a)}return r.join("")}},{key:"FromHex",value:function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2){var n=e.slice(r,r+2);t[r/2]=parseInt(n,16)}return t.buffer}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}}]),e}(),A=function(){function e(){i(this,e)}return o(e,null,[{key:"toArrayBuffer",value:function(e){var t=this.toUint8Array(e);return t.byteOffset||t.length?t.buffer.slice(t.byteOffset,t.byteOffset+t.length):t.buffer}},{key:"toUint8Array",value:function(e){if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}},{key:"isBufferSource",value:function(e){return ArrayBuffer.isView(e)||e instanceof ArrayBuffer}}]),e}(),x=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),t}(y(Error)),S=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),t}(x),C=function(e){function t(e){return i(this,t),p(this,h(t).call(this,"Unsupported operation: ".concat(e?"".concat(e):"")))}return l(t,e),t}(x),R=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),t}(x),N=function(e){function t(e){return i(this,t),p(this,h(t).call(this,"".concat(e,": Missing required property")))}return l(t,e),t}(x);function E(e){return"object"===n(e)&&"kty"in e}var K=function(){function e(){i(this,e)}return o(e,[{key:"digest",value:function(e,t){var r=arguments;return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkDigest.apply(this,r),e.abrupt("return",this.onDigest.apply(this,r));case 2:case"end":return e.stop()}}),null,this)}},{key:"checkDigest",value:function(e,t){this.checkAlgorithmName(e)}},{key:"onDigest",value:function(e,t){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C("digest");case 1:case"end":return e.stop()}}))}},{key:"generateKey",value:function(e,t,r){var n=arguments;return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkGenerateKey.apply(this,n),e.abrupt("return",this.onGenerateKey.apply(this,n));case 2:case"end":return e.stop()}}),null,this)}},{key:"checkGenerateKey",value:function(e,t,r){if(this.checkAlgorithmName(e),this.checkGenerateKeyParams(e),!r||!r.length)throw new TypeError("Usages cannot be empty when creating a key.");var n;n=Array.isArray(this.usages)?this.usages:this.usages.privateKey.concat(this.usages.publicKey),this.checkKeyUsages(r,n)}},{key:"checkGenerateKeyParams",value:function(e){}},{key:"onGenerateKey",value:function(e,t,r){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C("generateKey");case 1:case"end":return e.stop()}}))}},{key:"sign",value:function(e,t,r){var n=arguments;return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkSign.apply(this,n),e.abrupt("return",this.onSign.apply(this,n));case 2:case"end":return e.stop()}}),null,this)}},{key:"checkSign",value:function(e,t,r){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,"sign")}},{key:"onSign",value:function(e,t,r){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C("sign");case 1:case"end":return e.stop()}}))}},{key:"verify",value:function(e,t,r,n){var i=arguments;return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkVerify.apply(this,i),e.abrupt("return",this.onVerify.apply(this,i));case 2:case"end":return e.stop()}}),null,this)}},{key:"checkVerify",value:function(e,t,r,n){this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,"verify")}},{key:"onVerify",value:function(e,t,r,n){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C("verify");case 1:case"end":return e.stop()}}))}},{key:"encrypt",value:function(e,t,r,n){var i=arguments;return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkEncrypt.apply(this,i),e.abrupt("return",this.onEncrypt.apply(this,i));case 2:case"end":return e.stop()}}),null,this)}},{key:"checkEncrypt",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"encrypt":void 0)}},{key:"onEncrypt",value:function(e,t,r){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C("encrypt");case 1:case"end":return e.stop()}}))}},{key:"decrypt",value:function(e,t,r,n){var i=arguments;return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkDecrypt.apply(this,i),e.abrupt("return",this.onDecrypt.apply(this,i));case 2:case"end":return e.stop()}}),null,this)}},{key:"checkDecrypt",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"decrypt":void 0)}},{key:"onDecrypt",value:function(e,t,r){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C("decrypt");case 1:case"end":return e.stop()}}))}},{key:"deriveBits",value:function(e,t,r,n){var i=arguments;return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkDeriveBits.apply(this,i),e.abrupt("return",this.onDeriveBits.apply(this,i));case 2:case"end":return e.stop()}}),null,this)}},{key:"checkDeriveBits",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.checkAlgorithmName(e),this.checkAlgorithmParams(e),this.checkCryptoKey(t,n.keyUsage?"deriveBits":void 0),r%8!=0)throw new R("length: Is not multiple of 8")}},{key:"onDeriveBits",value:function(e,t,r){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C("deriveBits");case 1:case"end":return e.stop()}}))}},{key:"exportKey",value:function(e,t){var r=arguments;return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkExportKey.apply(this,r),e.abrupt("return",this.onExportKey.apply(this,r));case 2:case"end":return e.stop()}}),null,this)}},{key:"checkExportKey",value:function(e,t){if(this.checkKeyFormat(e),this.checkCryptoKey(t),!t.extractable)throw new x("key: Is not extractable")}},{key:"onExportKey",value:function(e,t){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C("exportKey");case 1:case"end":return e.stop()}}))}},{key:"importKey",value:function(e,t,r,n,i){var a=arguments;return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkImportKey.apply(this,a),e.abrupt("return",this.onImportKey.apply(this,a));case 2:case"end":return e.stop()}}),null,this)}},{key:"checkImportKey",value:function(e,t,r,n,i){this.checkKeyFormat(e),this.checkKeyData(e,t),this.checkAlgorithmName(r),this.checkImportParams(r),Array.isArray(this.usages)&&this.checkKeyUsages(i,this.usages)}},{key:"onImportKey",value:function(e,t,r,n,i){return regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C("importKey");case 1:case"end":return e.stop()}}))}},{key:"checkAlgorithmName",value:function(e){if(e.name.toLowerCase()!==this.name.toLowerCase())throw new S("Unrecognized name")}},{key:"checkAlgorithmParams",value:function(e){}},{key:"checkDerivedKeyParams",value:function(e){}},{key:"checkKeyUsages",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;if(-1===t.indexOf(u))throw new TypeError("Cannot create a key using the specified key usages")}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}},{key:"checkCryptoKey",value:function(e,t){if(this.checkAlgorithmName(e.algorithm),t&&-1===e.usages.indexOf(t))throw new x("key does not match that of operation")}},{key:"checkRequiredProperty",value:function(e,t){if(!(t in e))throw new N(t)}},{key:"checkHashAlgorithm",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){if(a.value.toLowerCase()===e.name.toLowerCase())return}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}throw new R("hash: Must be one of ".concat(t.join(", ")))}},{key:"checkImportParams",value:function(e){}},{key:"checkKeyFormat",value:function(e){switch(e){case"raw":case"pkcs8":case"spki":case"jwk":break;default:throw new TypeError("format: Is invalid value. Must be 'jwk', 'raw', 'spki', or 'pkcs8'")}}},{key:"checkKeyData",value:function(e,t){if(!t)throw new TypeError("keyData: Cannot be empty on empty on key importing");if("jwk"===e){if(!E(t))throw new TypeError("keyData: Is not JsonWebToken")}else if(!A.isBufferSource(t))throw new TypeError("keyData: Is not ArrayBufferView or ArrayBuffer")}},{key:"prepareData",value:function(e){return A.toArrayBuffer(e)}}]),e}(),O=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),o(t,[{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not of type Number");switch(e.length){case 128:case 192:case 256:break;default:throw new TypeError("length: Must be 128, 192, or 256")}}},{key:"checkDerivedKeyParams",value:function(e){this.checkGenerateKeyParams(e)}}]),t}(K),U=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="AES-CBC",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return l(t,e),o(t,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(16!==e.iv.byteLength)throw new TypeError("iv: Must have length 16 bytes")}}]),t}(O),H=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="AES-CTR",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return l(t,e),o(t,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"counter"),!(e.counter instanceof ArrayBuffer||ArrayBuffer.isView(e.counter)))throw new TypeError("counter: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(16!==e.counter.byteLength)throw new TypeError("iv: Must have length 16 bytes");if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not a Number");if(e.length<1)throw new R("length: Must be more than 0")}}]),t}(O),L=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="AES-ECB",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return l(t,e),t}(O),P=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="AES-GCM",e.usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return l(t,e),o(t,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength<1)throw new R("iv: Must have length more than 0 and less than 2^64 - 1");switch("tagLength"in e||(e.tagLength=128),e.tagLength){case 32:case 64:case 96:case 104:case 112:case 120:case 128:break;default:throw new R("tagLength: Must be one of 32, 64, 96, 104, 112, 120 or 128")}}}]),t}(O),I=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="AES-KW",e.usages=["wrapKey","unwrapKey"],e}return l(t,e),t}(O),T=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).usages=["encrypt","decrypt","wrapKey","unwrapKey"],e}return l(t,e),o(t,[{key:"checkAlgorithmParams",value:function(e){if(this.ivSize){if(this.checkRequiredProperty(e,"iv"),!(e.iv instanceof ArrayBuffer||ArrayBuffer.isView(e.iv)))throw new TypeError("iv: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(e.iv.byteLength!==this.ivSize)throw new TypeError("iv: Must have length ".concat(this.ivSize," bytes"))}}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"length"),"number"!=typeof e.length)throw new TypeError("length: Is not of type Number");if(e.length!==this.keySizeBits)throw new R("algorith.length: Must be ".concat(this.keySizeBits))}},{key:"checkDerivedKeyParams",value:function(e){this.checkGenerateKeyParams(e)}}]),t}(K),D=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e}return l(t,e),o(t,[{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");var t=B.ToBase64(e.publicExponent);if("Aw=="!==t&&"AQAB"!==t)throw new TypeError("publicExponent: Must be [3] or [1,0,1]");switch(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength){case 1024:case 2048:case 4096:break;default:throw new TypeError("modulusLength: Must be 1024, 2048, or 4096")}}},{key:"checkImportParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),t}(K),j=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="RSASSA-PKCS1-v1_5",e.usages={privateKey:["sign"],publicKey:["verify"]},e}return l(t,e),t}(D),_=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="RSA-PSS",e.usages={privateKey:["sign"],publicKey:["verify"]},e}return l(t,e),o(t,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"saltLength"),"number"!=typeof e.saltLength)throw new TypeError("saltLength: Is not a Number");if(e.saltLength<1)throw new RangeError("saltLength: Must be more than 0")}}]),t}(D),V=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="RSA-OAEP",e.usages={privateKey:["decrypt","unwrapKey"],publicKey:["encrypt","wrapKey"]},e}return l(t,e),o(t,[{key:"checkAlgorithmParams",value:function(e){if(e.label&&!(e.label instanceof ArrayBuffer||ArrayBuffer.isView(e.label)))throw new TypeError("label: Is not of type '(ArrayBuffer or ArrayBufferView)'")}}]),t}(D),J=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),o(t,[{key:"checkGenerateKeyParams",value:function(e){this.checkRequiredProperty(e,"namedCurve"),this.checkNamedCurve(e.namedCurve)}},{key:"checkNamedCurve",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this.namedCurves[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){if(i.value.toLowerCase()===e.toLowerCase())return}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}throw new R("namedCurve: Must be one of ".concat(this.namedCurves.join(", ")))}}]),t}(K),M=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="ECDSA",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages={privateKey:["sign"],publicKey:["verify"]},e.namedCurves=["P-256","P-384","P-521","K-256"],e}return l(t,e),o(t,[{key:"checkAlgorithmParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),t}(J),F=["secret","private","public"],z=function(){function e(){i(this,e)}return o(e,null,[{key:"create",value:function(e,t,r,n){var i=new this;return i.algorithm=e,i.type=t,i.extractable=r,i.usages=n,i}},{key:"isKeyType",value:function(e){return-1!==F.indexOf(e)}}]),e}(),G=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="ECDH",e.usages={privateKey:["deriveBits","deriveKey"],publicKey:[]},e.namedCurves=["P-256","P-384","P-521","K-256"],e}return l(t,e),o(t,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"public"),!(e.public instanceof z))throw new TypeError("public: Is not a CryptoKey");if("public"!==e.public.type)throw new R("public: Is not a public key");if(e.public.algorithm.name!==this.name)throw new R("public: Is not ".concat(this.name," key"))}}]),t}(J),q=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="HMAC",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages=["sign","verify"],e}return l(t,e),o(t,[{key:"getDefaultLength",value:function(e){switch(e.toUpperCase()){case"SHA-1":return 160;case"SHA-256":return 256;case"SHA-384":return 384;case"SHA-512":return 512;default:throw new Error("Unknown algorithm name '".concat(e,"'"))}}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),"length"in e){if("number"!=typeof e.length)throw new TypeError("length: Is not a Number");if(e.length<1)throw new RangeError("length: Number is out of range")}}},{key:"checkImportParams",value:function(e){this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms)}}]),t}(K),W=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="PBKDF2",e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e.usages=["deriveBits","deriveKey"],e}return l(t,e),o(t,[{key:"checkAlgorithmParams",value:function(e){if(this.checkRequiredProperty(e,"hash"),this.checkHashAlgorithm(e.hash,this.hashAlgorithms),this.checkRequiredProperty(e,"salt"),!(e.salt instanceof ArrayBuffer||ArrayBuffer.isView(e.salt)))throw new TypeError("salt: Is not of type '(ArrayBuffer or ArrayBufferView)'");if(this.checkRequiredProperty(e,"iterations"),"number"!=typeof e.iterations)throw new TypeError("iterations: Is not a Number");if(e.iterations<1)throw new TypeError("iterations: Is less than 1")}},{key:"checkImportKey",value:function(e,r,n,i,a){if(g(h(t.prototype),"checkImportKey",this).call(this,e,r,n,i,a),i)throw new SyntaxError("extractable: Must be False")}}]),t}(K),Z=function(){function e(){i(this,e),this.items={}}return o(e,[{key:"get",value:function(e){return this.items[e.toLowerCase()]||null}},{key:"set",value:function(e){this.items[e.name.toLowerCase()]=e}},{key:"removeAt",value:function(e){var t=this.get(e.toLowerCase());return t&&delete this.items[e],t}},{key:"has",value:function(e){return!!this.get(e)}},{key:"length",get:function(){return Object.keys(this.items).length}},{key:"algorithms",get:function(){var e=[];for(var t in this.items){var r=this.items[t];e.push(r.name)}return e.sort()}}]),e}(),$=function(){function e(){i(this,e),this.providers=new Z}return o(e,[{key:"digest",value:function(e,t){var r,n,i,a,o=arguments;return regeneratorRuntime.async((function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkRequiredArguments(o,2,"digest"),r=this.prepareAlgorithm(e),n=A.toArrayBuffer(t),i=this.getProvider(r.name),u.next=6,regeneratorRuntime.awrap(i.digest(r,n));case 6:return a=u.sent,u.abrupt("return",a);case 8:case"end":return u.stop()}}),null,this)}},{key:"generateKey",value:function(e,t,r){var n,i,a,o=arguments;return regeneratorRuntime.async((function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkRequiredArguments(o,3,"generateKey"),n=this.prepareAlgorithm(e),i=this.getProvider(n.name),u.next=5,regeneratorRuntime.awrap(i.generateKey(c({},n,{name:i.name}),t,r));case 5:return a=u.sent,u.abrupt("return",a);case 7:case"end":return u.stop()}}),null,this)}},{key:"sign",value:function(e,t,r){var n,i,a,o,u=arguments;return regeneratorRuntime.async((function(s){for(;;)switch(s.prev=s.next){case 0:return this.checkRequiredArguments(u,3,"sign"),this.checkCryptoKey(t),n=this.prepareAlgorithm(e),i=A.toArrayBuffer(r),a=this.getProvider(n.name),s.next=7,regeneratorRuntime.awrap(a.sign(c({},n,{name:a.name}),t,i));case 7:return o=s.sent,s.abrupt("return",o);case 9:case"end":return s.stop()}}),null,this)}},{key:"verify",value:function(e,t,r,n){var i,a,o,u,s,l=arguments;return regeneratorRuntime.async((function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkRequiredArguments(l,4,"verify"),this.checkCryptoKey(t),i=this.prepareAlgorithm(e),a=A.toArrayBuffer(n),o=A.toArrayBuffer(r),u=this.getProvider(i.name),h.next=8,regeneratorRuntime.awrap(u.verify(c({},i,{name:u.name}),t,o,a));case 8:return s=h.sent,h.abrupt("return",s);case 10:case"end":return h.stop()}}),null,this)}},{key:"encrypt",value:function(e,t,r){var n,i,a,o,u=arguments;return regeneratorRuntime.async((function(s){for(;;)switch(s.prev=s.next){case 0:return this.checkRequiredArguments(u,3,"encrypt"),this.checkCryptoKey(t),n=this.prepareAlgorithm(e),i=A.toArrayBuffer(r),a=this.getProvider(n.name),s.next=7,regeneratorRuntime.awrap(a.encrypt(c({},n,{name:a.name}),t,i,{keyUsage:!0}));case 7:return o=s.sent,s.abrupt("return",o);case 9:case"end":return s.stop()}}),null,this)}},{key:"decrypt",value:function(e,t,r){var n,i,a,o,u=arguments;return regeneratorRuntime.async((function(s){for(;;)switch(s.prev=s.next){case 0:return this.checkRequiredArguments(u,3,"decrypt"),this.checkCryptoKey(t),n=this.prepareAlgorithm(e),i=A.toArrayBuffer(r),a=this.getProvider(n.name),s.next=7,regeneratorRuntime.awrap(a.decrypt(c({},n,{name:a.name}),t,i,{keyUsage:!0}));case 7:return o=s.sent,s.abrupt("return",o);case 9:case"end":return s.stop()}}),null,this)}},{key:"deriveBits",value:function(e,t,r){var n,i,a,o=arguments;return regeneratorRuntime.async((function(u){for(;;)switch(u.prev=u.next){case 0:return this.checkRequiredArguments(o,3,"deriveBits"),this.checkCryptoKey(t),n=this.prepareAlgorithm(e),i=this.getProvider(n.name),u.next=6,regeneratorRuntime.awrap(i.deriveBits(c({},n,{name:i.name}),t,r,{keyUsage:!0}));case 6:return a=u.sent,u.abrupt("return",a);case 8:case"end":return u.stop()}}),null,this)}},{key:"deriveKey",value:function(e,t,r,n,i){var a,o,u,s,l=arguments;return regeneratorRuntime.async((function(h){for(;;)switch(h.prev=h.next){case 0:return this.checkRequiredArguments(l,5,"deriveKey"),a=this.prepareAlgorithm(r),this.getProvider(a.name).checkDerivedKeyParams(a),o=this.prepareAlgorithm(e),(u=this.getProvider(o.name)).checkCryptoKey(t,"deriveKey"),h.next=9,regeneratorRuntime.awrap(u.deriveBits(c({},o,{name:u.name}),t,r.length,{keyUsage:!1}));case 9:return s=h.sent,h.abrupt("return",this.importKey("raw",s,r,n,i));case 11:case"end":return h.stop()}}),null,this)}},{key:"exportKey",value:function(e,t){var r,n,i=arguments;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return this.checkRequiredArguments(i,2,"exportKey"),this.checkCryptoKey(t),r=this.getProvider(t.algorithm.name),a.next=5,regeneratorRuntime.awrap(r.exportKey(e,t));case 5:return n=a.sent,a.abrupt("return",n);case 7:case"end":return a.stop()}}),null,this)}},{key:"importKey",value:function(e,t,r,n,i){var a,o,u,s=arguments;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:if(this.checkRequiredArguments(s,5,"importKey"),a=this.prepareAlgorithm(r),o=this.getProvider(a.name),-1===["pkcs8","spki","raw"].indexOf(e)){l.next=8;break}return u=A.toArrayBuffer(t),l.abrupt("return",o.importKey(e,u,c({},a,{name:o.name}),n,i));case 8:if(t.kty){l.next=10;break}throw new TypeError("keyData: Is not JSON");case 10:return l.abrupt("return",o.importKey(e,t,c({},a,{name:o.name}),n,i));case 11:case"end":return l.stop()}}),null,this)}},{key:"wrapKey",value:function(e,t,r,n){var i,a,o,u,s;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,regeneratorRuntime.awrap(this.exportKey(e,t));case 2:return i=l.sent,"jwk"===e&&(a=JSON.stringify(i),i=B.FromUtf8String(a)),o=this.prepareAlgorithm(n),u=A.toArrayBuffer(i),s=this.getProvider(o.name),l.abrupt("return",s.encrypt(c({},o,{name:s.name}),r,u,{keyUsage:!1}));case 8:case"end":return l.stop()}}),null,this)}},{key:"unwrapKey",value:function(e,t,r,n,i,a,o){var u,s,l,h,f;return regeneratorRuntime.async((function(v){for(;;)switch(v.prev=v.next){case 0:return u=this.prepareAlgorithm(n),s=A.toArrayBuffer(t),l=this.getProvider(u.name),v.next=5,regeneratorRuntime.awrap(l.decrypt(c({},u,{name:l.name}),r,s,{keyUsage:!1}));case 5:if(h=v.sent,"jwk"!==e){v.next=16;break}v.prev=7,h=JSON.parse(B.ToUtf8String(h)),v.next=16;break;case 11:throw v.prev=11,v.t0=v.catch(7),(f=new TypeError("wrappedKey: Is not a JSON")).internal=v.t0,f;case 16:return v.abrupt("return",this.importKey(e,h,i,a,o));case 17:case"end":return v.stop()}}),null,this,[[7,11]])}},{key:"checkRequiredArguments",value:function(e,t,r){if(e.length!==t)throw new TypeError("Failed to execute '".concat(r,"' on 'SubtleCrypto': ").concat(t," arguments required, but only ").concat(e.length," present"))}},{key:"prepareAlgorithm",value:function(t){if("string"==typeof t)return{name:t};if(e.isHashedAlgorithm(t)){var r=c({},t);return r.hash=this.prepareAlgorithm(t.hash),r}return c({},t)}},{key:"getProvider",value:function(e){var t=this.providers.get(e);if(!t)throw new S("Unrecognized name");return t}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof z))throw new TypeError("Key is not of type 'CryptoKey'")}}],[{key:"isHashedAlgorithm",value:function(e){return e instanceof Object&&"name"in e&&"hash"in e}}]),e}();function X(e,t,r,i){var a,o=arguments.length,u=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"===("undefined"==typeof Reflect?"undefined":n(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(u=(o<3?a(u):o>3?a(t,r,u):a(t,r))||u);return o>3&&u&&Object.defineProperty(t,r,u),u}function Y(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new r((function(t){t(e.value)})).then(o,u)}s((n=n.apply(e,t||[])).next())}))}function Q(e,t){return e(t={exports:{}},t.exports),t.exports}function ee(e,t){var r=0;if(1===e.length)return e[0];for(var n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function te(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=e,i=0,a=Math.pow(2,t),o=1;o<8;o++){if(e<a){var u=void 0;if(r<0)u=new ArrayBuffer(o),i=o;else{if(r<o)return new ArrayBuffer(0);u=new ArrayBuffer(r),i=r}for(var s=new Uint8Array(u),c=o-1;c>=0;c--){var l=Math.pow(2,c*t);s[i-c-1]=Math.floor(n/l),n-=s[i-c-1]*l}return u}a*=Math.pow(2,t)}return new ArrayBuffer(0)}var re="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ne="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";var ie=Math.log(2);var ae,oe=Object.freeze({__proto__:null,getUTCDate:function(e){return new Date(e.getTime()+6e4*e.getTimezoneOffset())},getParametersValue:function(e,t,r){return e instanceof Object==!1?r:t in e?e[t]:r},bufferToHexCodes:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength-t,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i="",a=!0,o=!1,u=void 0;try{for(var s,c=new Uint8Array(e,t,r)[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var l=s.value.toString(16).toUpperCase();1===l.length&&(i+="0"),i+=l,n&&(i+=" ")}}catch(e){o=!0,u=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw u}}return i.trim()},checkBufferParams:function(e,t,r,n){return t instanceof ArrayBuffer==!1?(e.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1):0===t.byteLength?(e.error="Wrong parameter: inputBuffer has zero length",!1):r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1)},utilFromBase:ee,utilToBase:te,utilConcatBuf:function(){for(var e=0,t=0,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];for(var a=0,o=n;a<o.length;a++){e+=o[a].byteLength}for(var u=new ArrayBuffer(e),s=new Uint8Array(u),c=0,l=n;c<l.length;c++){var h=l[c];s.set(new Uint8Array(h),t),t+=h.byteLength}return u},utilConcatView:function(){for(var e=0,t=0,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];for(var a=0,o=n;a<o.length;a++){e+=o[a].length}for(var u=new ArrayBuffer(e),s=new Uint8Array(u),c=0,l=n;c<l.length;c++){var h=l[c];s.set(h,t),t+=h.length}return s},utilDecodeTC:function(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var n=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(n),a=0;a<this.valueHex.byteLength;a++)i[a]=0;i[0]=128&e[0];for(var o=ee(i,8),u=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(u),c=0;c<this.valueHex.byteLength;c++)s[c]=e[c];return s[0]&=127,ee(s,8)-o},utilEncodeTC:function(e){for(var t=e<0?-1*e:e,r=128,n=1;n<8;n++){if(t<=r){if(e<0){var i=te(r-t,8,n);return new Uint8Array(i)[0]|=128,i}var a=te(t,8,n),o=new Uint8Array(a);if(128&o[0]){var u=a.slice(0),s=new Uint8Array(u);a=new ArrayBuffer(a.byteLength+1),o=new Uint8Array(a);for(var c=0;c<u.byteLength;c++)o[c+1]=s[c];o[0]=0}return a}r*=Math.pow(2,8)}return new ArrayBuffer(0)},isEqualBuffer:function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<r.length;i++)if(r[i]!==n[i])return!1;return!0},padNumber:function(e,t){var r=e.toString(10);if(t<r.length)return"";for(var n=t-r.length,i=new Array(n),a=0;a<n;a++)i[a]="0";return i.join("").concat(r)},toBase64:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=0,a=0,o=0,u="",s=t?ne:re;if(n){for(var c=0,l=0;l<e.length;l++)if(0!==e.charCodeAt(l)){c=l;break}e=e.slice(c)}for(;i<e.length;){var h=e.charCodeAt(i++);i>=e.length&&(a=1);var f=e.charCodeAt(i++);i>=e.length&&(o=1);var v=e.charCodeAt(i++),y=h>>2,p=(3&h)<<4|f>>4,g=(15&f)<<2|v>>6,m=63&v;1===a?g=m=64:1===o&&(m=64),u+=r?64===g?"".concat(s.charAt(y)).concat(s.charAt(p)):64===m?"".concat(s.charAt(y)).concat(s.charAt(p)).concat(s.charAt(g)):"".concat(s.charAt(y)).concat(s.charAt(p)).concat(s.charAt(g)).concat(s.charAt(m)):"".concat(s.charAt(y)).concat(s.charAt(p)).concat(s.charAt(g)).concat(s.charAt(m))}return u},fromBase64:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t?ne:re;function i(e){for(var t=0;t<64;t++)if(n.charAt(t)===e)return t;return 64}function a(e){return 64===e?0:e}for(var o=0,u="";o<e.length;){var s=i(e.charAt(o++)),c=o>=e.length?0:i(e.charAt(o++)),l=o>=e.length?0:i(e.charAt(o++)),h=o>=e.length?0:i(e.charAt(o++)),f=a(s)<<2|a(c)>>4,v=(15&a(c))<<4|a(l)>>2,y=(3&a(l))<<6|a(h);u+=String.fromCharCode(f),64!==l&&(u+=String.fromCharCode(v)),64!==h&&(u+=String.fromCharCode(y))}if(r){for(var p=-1,g=u.length-1;g>=0;g--)if(0!==u.charCodeAt(g)){p=g;break}u=-1!==p?u.slice(0,p+1):""}return u},arrayBufferToString:function(e){var t="",r=new Uint8Array(e),n=!0,i=!1,a=void 0;try{for(var o,u=r[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;t+=String.fromCharCode(s)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}return t},stringToArrayBuffer:function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r},nearestPowerOf2:function(e){var t=Math.log(e)/ie,r=Math.floor(t),n=Math.round(t);return r===n?r:n},clearProps:function(e,t){var r=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){delete e[a.value]}}catch(e){n=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}}),ue=Q((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.fromBER=pe,t.compareSchema=ge,t.verifySchema=function(e,t){if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};var r=pe(e);if(-1===r.offset)return{verified:!1,result:r.result};return ge(r.result,r.result,t)},t.fromJSON=function(e){},t.RawData=t.Repeated=t.Any=t.Choice=t.TIME=t.Duration=t.DateTime=t.TimeOfDay=t.DATE=t.GeneralizedTime=t.UTCTime=t.CharacterString=t.GeneralString=t.VisibleString=t.GraphicString=t.IA5String=t.VideotexString=t.TeletexString=t.PrintableString=t.NumericString=t.UniversalString=t.BmpString=t.RelativeObjectIdentifier=t.Utf8String=t.ObjectIdentifier=t.Enumerated=t.Integer=t.BitString=t.OctetString=t.Null=t.Set=t.Sequence=t.Boolean=t.EndOfContent=t.Constructed=t.Primitive=t.BaseBlock=t.ValueBlock=t.HexBlock=void 0;var r=[new Uint8Array([1])],n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.blockLength=(0,oe.getParametersValue)(t,"blockLength",0),this.error=(0,oe.getParametersValue)(t,"error",""),this.warnings=(0,oe.getParametersValue)(t,"warnings",[]),this.valueBeforeDecode="valueBeforeDecode"in t?t.valueBeforeDecode.slice(0):new ArrayBuffer(0)}return o(e,[{key:"toJSON",value:function(){return{blockName:this.constructor.blockName(),blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:(0,oe.bufferToHexCodes)(this.valueBeforeDecode,0,this.valueBeforeDecode.byteLength)}}}],[{key:"blockName",value:function(){return"baseBlock"}}]),e}(),a=function(e){return function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).isHexOnly=(0,oe.getParametersValue)(r,"isHexOnly",!1),e.valueHex="valueHex"in r?r.valueHex.slice(0):new ArrayBuffer(0),e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){return!1===(0,oe.checkBufferParams)(this,e,t,r)?-1:0===new Uint8Array(e,t,r).length?(this.warnings.push("Zero buffer length"),t):(this.valueHex=e.slice(t,t+r),this.blockLength=r,t+r)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!0!==this.isHexOnly?(this.error='Flag "isHexOnly" is not set, abort',new ArrayBuffer(0)):!0===e?new ArrayBuffer(this.valueHex.byteLength):this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isHexOnly=this.isHexOnly,e.valueHex=(0,oe.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"hexBlock"}}]),t}(e)};t.HexBlock=a;var u=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=p(this,h(t).call(this)),"idBlock"in r?(e.isHexOnly=(0,oe.getParametersValue)(r.idBlock,"isHexOnly",!1),e.valueHex=(0,oe.getParametersValue)(r.idBlock,"valueHex",new ArrayBuffer(0)),e.tagClass=(0,oe.getParametersValue)(r.idBlock,"tagClass",-1),e.tagNumber=(0,oe.getParametersValue)(r.idBlock,"tagNumber",-1),e.isConstructed=(0,oe.getParametersValue)(r.idBlock,"isConstructed",!1)):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return l(t,e),o(t,[{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=0;switch(this.tagClass){case 1:n|=0;break;case 2:n|=64;break;case 3:n|=128;break;case 4:n|=192;break;default:return this.error="Unknown tag class",new ArrayBuffer(0)}if(this.isConstructed&&(n|=32),this.tagNumber<31&&!this.isHexOnly){if(e=new ArrayBuffer(1),t=new Uint8Array(e),!r){var i=this.tagNumber;n|=i&=31,t[0]=n}return e}if(!1===this.isHexOnly){var a=(0,oe.utilToBase)(this.tagNumber,7),o=new Uint8Array(a),u=a.byteLength;if(e=new ArrayBuffer(u+1),(t=new Uint8Array(e))[0]=31|n,!r){for(var s=0;s<u-1;s++)t[s+1]=128|o[s];t[u]=o[u-1]}return e}if(e=new ArrayBuffer(this.valueHex.byteLength+1),(t=new Uint8Array(e))[0]=31|n,!1===r){for(var c=new Uint8Array(this.valueHex),l=0;l<c.length-1;l++)t[l+1]=128|c[l];t[this.valueHex.byteLength]=c[c.length-1]}return e}},{key:"fromBER",value:function(e,t,r){if(!1===(0,oe.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&n[0]),this.isHexOnly=!1;var i=31&n[0];if(31!==i)this.tagNumber=i,this.blockLength=1;else{var a=1;this.valueHex=new ArrayBuffer(255);for(var o=255,u=new Uint8Array(this.valueHex);128&n[a];){if(u[a-1]=127&n[a],++a>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(a===o){o+=255;for(var s=new ArrayBuffer(o),c=new Uint8Array(s),l=0;l<u.length;l++)c[l]=u[l];this.valueHex=new ArrayBuffer(o),u=new Uint8Array(this.valueHex)}}this.blockLength=a+1,u[a-1]=127&n[a];for(var h=new ArrayBuffer(a),f=new Uint8Array(h),v=0;v<a;v++)f[v]=u[v];this.valueHex=new ArrayBuffer(a),(u=new Uint8Array(this.valueHex)).set(f),this.blockLength<=9?this.tagNumber=(0,oe.utilFromBase)(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.tagClass=this.tagClass,e.tagNumber=this.tagNumber,e.isConstructed=this.isConstructed,e}}],[{key:"blockName",value:function(){return"identificationBlock"}}]),t}(a(n)),s=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=p(this,h(t).call(this)),"lenBlock"in r?(e.isIndefiniteForm=(0,oe.getParametersValue)(r.lenBlock,"isIndefiniteForm",!1),e.longFormUsed=(0,oe.getParametersValue)(r.lenBlock,"longFormUsed",!1),e.length=(0,oe.getParametersValue)(r.lenBlock,"length",0)):(e.isIndefiniteForm=!1,e.longFormUsed=!1,e.length=0),e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){if(!1===(0,oe.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],!0===this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,t+this.blockLength;var i=127&n[0];if(i>8)return this.error="Too big integer",-1;if(i+1>n.length)return this.error="End of input reached before message was fully decoded",-1;for(var a=new Uint8Array(i),o=0;o<i;o++)a[o]=n[o+1];return 0===a[i-1]&&this.warnings.push("Needlessly long encoded length"),this.length=(0,oe.utilFromBase)(a,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unneccesary usage of long length form"),this.blockLength=i+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(!0===this.longFormUsed){var n=(0,oe.utilToBase)(this.length,8);if(n.byteLength>127)return this.error="Too big length",new ArrayBuffer(0);if(e=new ArrayBuffer(n.byteLength+1),!0===r)return e;var i=new Uint8Array(n);(t=new Uint8Array(e))[0]=128|n.byteLength;for(var a=0;a<n.byteLength;a++)t[a+1]=i[a];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isIndefiniteForm=this.isIndefiniteForm,e.longFormUsed=this.longFormUsed,e.length=this.length,e}}],[{key:"blockName",value:function(){return"lengthBlock"}}]),t}(n),c=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),p(this,h(t).call(this,e))}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}},{key:"toBER",value:function(){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}}],[{key:"blockName",value:function(){return"valueBlock"}}]),t}(n);t.ValueBlock=c;var f=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c;return i(this,t),e=p(this,h(t).call(this,r)),"name"in r&&(e.name=r.name),"optional"in r&&(e.optional=r.optional),"primitiveSchema"in r&&(e.primitiveSchema=r.primitiveSchema),e.idBlock=new u(r),e.lenBlock=new s(r),e.valueBlock=new n(r),e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toBER",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.idBlock.toBER(t),n=this.valueBlock.toBER(!0);this.lenBlock.length=n.byteLength;var i,a=this.lenBlock.toBER(t);if(e=(0,oe.utilConcatBuf)(r,a),i=!1===t?this.valueBlock.toBER(t):new ArrayBuffer(this.lenBlock.length),e=(0,oe.utilConcatBuf)(e,i),!0===this.lenBlock.isIndefiniteForm){var o=new ArrayBuffer(2);if(!1===t){var u=new Uint8Array(o);u[0]=0,u[1]=0}e=(0,oe.utilConcatBuf)(e,o)}return e}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.idBlock=this.idBlock.toJSON(),e.lenBlock=this.lenBlock.toJSON(),e.valueBlock=this.valueBlock.toJSON(),"name"in this&&(e.name=this.name),"optional"in this&&(e.optional=this.optional),"primitiveSchema"in this&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}}],[{key:"blockName",value:function(){return"BaseBlock"}}]),t}(n);t.BaseBlock=f;var v=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).valueHex="valueHex"in r?r.valueHex.slice(0):new ArrayBuffer(0),e.isHexOnly=(0,oe.getParametersValue)(r,"isHexOnly",!0),e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){if(!1===(0,oe.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.warnings.push("Zero buffer length"),t;this.valueHex=new ArrayBuffer(n.length);for(var i=new Uint8Array(this.valueHex),a=0;a<n.length;a++)i[a]=n[a];return this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.valueHex=(0,oe.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e.isHexOnly=this.isHexOnly,e}}],[{key:"blockName",value:function(){return"PrimitiveValueBlock"}}]),t}(c),y=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r,v))).idBlock.isConstructed=!1,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"PRIMITIVE"}}]),t}(f);t.Primitive=y;var m=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).value=(0,oe.getParametersValue)(r,"value",[]),e.isIndefiniteForm=(0,oe.getParametersValue)(r,"isIndefiniteForm",!1),e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){var n=t,i=r;if(!1===(0,oe.checkBufferParams)(this,e,t,r))return-1;if(0===new Uint8Array(e,t,r).length)return this.warnings.push("Zero buffer length"),t;for(var a,o,u=t;a=this.isIndefiniteForm,o=r,(!0===a?1:o)>0;){var s=ye(e,u,r);if(-1===s.offset)return this.error=s.result.error,this.warnings.concat(s.result.warnings),-1;if(u=s.offset,this.blockLength+=s.result.blockLength,r-=s.result.blockLength,this.value.push(s.result),!0===this.isIndefiniteForm&&s.result.constructor.blockName()===w.blockName())break}return!0===this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.blockName()===w.blockName()?this.value.pop():this.warnings.push("No EndOfContent block encoded")),this.valueBeforeDecode=e.slice(n,n+i),u}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);t=(0,oe.utilConcatBuf)(t,n)}return t}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}e.isIndefiniteForm=this.isIndefiniteForm,e.value=[];for(var r=0;r<this.value.length;r++)e.value.push(this.value[r].toJSON());return e}}],[{key:"blockName",value:function(){return"ConstructedValueBlock"}}]),t}(c),d=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r,m))).idBlock.isConstructed=!0,e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}}],[{key:"blockName",value:function(){return"CONSTRUCTED"}}]),t}(f);t.Constructed=d;var k=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),p(this,h(t).call(this,e))}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(){return new ArrayBuffer(0)}}],[{key:"blockName",value:function(){return"EndOfContentValueBlock"}}]),t}(c),w=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r,k))).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"EndOfContent"}}]),t}(f);t.EndOfContent=w;var b=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(i(this,t),(e=p(this,h(t).call(this,r))).value=(0,oe.getParametersValue)(r,"value",!1),e.isHexOnly=(0,oe.getParametersValue)(r,"isHexOnly",!1),"valueHex"in r)?e.valueHex=r.valueHex.slice(0):(e.valueHex=new ArrayBuffer(1),!0===e.value&&(new Uint8Array(e.valueHex)[0]=255));return e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){if(!1===(0,oe.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,this.valueHex=new ArrayBuffer(n.length);for(var i=new Uint8Array(this.valueHex),a=0;a<n.length;a++)i[a]=n[a];return 0!==oe.utilDecodeTC.call(this)?this.value=!0:this.value=!1,this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e.isHexOnly=this.isHexOnly,e.valueHex=(0,oe.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BooleanValueBlock"}}]),t}(c),B=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r,b))).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"Boolean"}}]),t}(f);t.Boolean=B;var A=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"Sequence"}}]),t}(d);t.Sequence=A;var x=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"Set"}}]),t}(d);t.Set=x;var S=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r,n))).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(2);if(!0===e)return t;var r=new Uint8Array(t);return r[0]=5,r[1]=0,t}}],[{key:"blockName",value:function(){return"Null"}}]),t}(f);t.Null=S;var C=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).isConstructed=(0,oe.getParametersValue)(r,"isConstructed",!1),e}return l(t,e),o(t,[{key:"fromBER",value:function(e,r,n){var i=0;if(!0===this.isConstructed){if(this.isHexOnly=!1,-1===(i=m.prototype.fromBER.call(this,e,r,n)))return i;for(var a=0;a<this.value.length;a++){var o=this.value[a].constructor.blockName();if(o===w.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==R.blockName())return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=g(h(t.prototype),"fromBER",this).call(this,e,r,n),this.blockLength=n;return i}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return m.prototype.toBER.call(this,e);var t=new ArrayBuffer(this.valueHex.byteLength);return!0===e?t:0===this.valueHex.byteLength?t:t=this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=(0,oe.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"OctetStringValueBlock"}}]),t}(a(m)),R=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r,C))).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return l(t,e),o(t,[{key:"fromBER",value:function(e,r,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n?(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),r):g(h(t.prototype),"fromBER",this).call(this,e,r,n)}},{key:"isEqual",value:function(e){return e instanceof t!=!1&&JSON.stringify(this)===JSON.stringify(e)}}],[{key:"blockName",value:function(){return"OctetString"}}]),t}(f);t.OctetString=R;var N=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).unusedBits=(0,oe.getParametersValue)(r,"unusedBits",0),e.isConstructed=(0,oe.getParametersValue)(r,"isConstructed",!1),e.blockLength=e.valueHex.byteLength,e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var n=-1;if(!0===this.isConstructed){if(-1===(n=m.prototype.fromBER.call(this,e,t,r)))return n;for(var i=0;i<this.value.length;i++){var a=this.value[i].constructor.blockName();if(a===w.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(a!==E.blockName())return this.error="BIT STRING may consists of BIT STRINGs only",-1;if(this.unusedBits>0&&this.value[i].valueBlock.unusedBits>0)return this.error='Usign of "unused bits" inside constructive BIT STRING allowed for least one only',-1;if(this.unusedBits=this.value[i].valueBlock.unusedBits,this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1}return n}if(!1===(0,oe.checkBufferParams)(this,e,t,r))return-1;var o=new Uint8Array(e,t,r);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;this.valueHex=new ArrayBuffer(o.length-1);for(var u=new Uint8Array(this.valueHex),s=0;s<r-1;s++)u[s]=o[s+1];return this.blockLength=o.length,t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return m.prototype.toBER.call(this,e);if(!0===e)return new ArrayBuffer(this.valueHex.byteLength+1);if(0===this.valueHex.byteLength)return new ArrayBuffer(0);var t=new Uint8Array(this.valueHex),r=new ArrayBuffer(this.valueHex.byteLength+1),n=new Uint8Array(r);n[0]=this.unusedBits;for(var i=0;i<this.valueHex.byteLength;i++)n[i+1]=t[i];return r}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.unusedBits=this.unusedBits,e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=(0,oe.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BitStringValueBlock"}}]),t}(a(m)),E=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r,N))).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return l(t,e),o(t,[{key:"fromBER",value:function(e,r,n){return 0===n?r:(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,g(h(t.prototype),"fromBER",this).call(this,e,r,n))}},{key:"isEqual",value:function(e){return e instanceof t!=!1&&JSON.stringify(this)===JSON.stringify(e)}}],[{key:"blockName",value:function(){return"BitString"}}]),t}(f);t.BitString=E;var K=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=p(this,h(t).call(this,r)),"value"in r&&(e.valueDec=r.value),e}return l(t,e),o(t,[{key:"fromDER",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=this.fromBER(e,t,r);if(-1===i)return i;var a=new Uint8Array(this._valueHex);if(0===a[0]&&0!=(128&a[1])){var o=new ArrayBuffer(this._valueHex.byteLength-1),u=new Uint8Array(o);u.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=o.slice(0)}else if(0!==n&&this._valueHex.byteLength<n){n-this._valueHex.byteLength>1&&(n=this._valueHex.byteLength+1);var s=new ArrayBuffer(n),c=new Uint8Array(s);c.set(a,n-this._valueHex.byteLength),this._valueHex=s.slice(0)}return i}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Uint8Array(this._valueHex);switch(!0){case 0!=(128&t[0]):var r=new ArrayBuffer(this._valueHex.byteLength+1),n=new Uint8Array(r);n[0]=0,n.set(t,1),this._valueHex=r.slice(0);break;case 0===t[0]&&0==(128&t[1]):var i=new ArrayBuffer(this._valueHex.byteLength-1),a=new Uint8Array(i);a.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=i.slice(0)}return this.toBER(e)}},{key:"fromBER",value:function(e,r,n){var i=g(h(t.prototype),"fromBER",this).call(this,e,r,n);return-1===i?i:(this.blockLength=n,r+n)}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}},{key:"toString",value:function(){function e(e,t){for(var r=new Uint8Array([0]),n=new Uint8Array(e),i=new Uint8Array(t),a=n.slice(0),o=a.length-1,u=i.slice(0),s=u.length-1,c=0,l=0,h=s<o?o:s;h>=0;h--,l++){switch(!0){case l<u.length:c=a[o-l]+u[s-l]+r[0];break;default:c=a[o-l]+r[0]}switch(r[0]=c/10,!0){case l>=a.length:a=(0,oe.utilConcatView)(new Uint8Array([c%10]),a);break;default:a[o-l]=c%10}}return r[0]>0&&(a=(0,oe.utilConcatView)(r,a)),a.slice(0)}function t(e){if(e>=r.length)for(var t=r.length;t<=e;t++){for(var n=new Uint8Array([0]),i=r[t-1].slice(0),a=i.length-1;a>=0;a--){var o=new Uint8Array([(i[a]<<1)+n[0]]);n[0]=o[0]/10,i[a]=o[0]%10}n[0]>0&&(i=(0,oe.utilConcatView)(n,i)),r.push(i)}return r[e]}function n(e,t){for(var r,n=0,i=new Uint8Array(e),a=new Uint8Array(t),o=i.slice(0),u=o.length-1,s=a.slice(0),c=s.length-1,l=0,h=c;h>=0;h--,l++)switch(r=o[u-l]-s[c-l]-n,!0){case r<0:n=1,o[u-l]=r+10;break;default:n=0,o[u-l]=r}if(n>0)for(var f=u-c+1;f>=0;f--,l++){if(!((r=o[u-l]-n)<0)){n=0,o[u-l]=r;break}n=1,o[u-l]=r+10}return o.slice()}for(var i,a=8*this._valueHex.byteLength-1,o=new Uint8Array(8*this._valueHex.byteLength/3),u=0,s=new Uint8Array(this._valueHex),c="",l=!1,h=this._valueHex.byteLength-1;h>=0;h--){i=s[h];for(var f=0;f<8;f++){if(1==(1&i))switch(u){case a:o=n(t(u),o),c="-";break;default:o=e(o,t(u))}u++,i>>=1}}for(var v=0;v<o.length;v++)o[v]&&(l=!0),l&&(c+="0123456789".charAt(o[v]));return!1===l&&(c+="0123456789".charAt(0)),c}},{key:"valueHex",set:function(e){this._valueHex=e.slice(0),e.byteLength>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,e.byteLength>0&&(this._valueDec=oe.utilDecodeTC.call(this)))},get:function(){return this._valueHex}},{key:"valueDec",set:function(e){this._valueDec=e,this.isHexOnly=!1,this._valueHex=(0,oe.utilEncodeTC)(e)},get:function(){return this._valueDec}}],[{key:"blockName",value:function(){return"IntegerValueBlock"}}]),t}(a(c)),O=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r,K))).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return l(t,e),o(t,[{key:"isEqual",value:function(e){return e instanceof t?this.valueBlock.isHexOnly&&e.valueBlock.isHexOnly?(0,oe.isEqualBuffer)(this.valueBlock.valueHex,e.valueBlock.valueHex):this.valueBlock.isHexOnly===e.valueBlock.isHexOnly&&this.valueBlock.valueDec===e.valueBlock.valueDec:e instanceof ArrayBuffer&&(0,oe.isEqualBuffer)(this.valueBlock.valueHex,e)}},{key:"convertToDER",value:function(){var e=new t({valueHex:this.valueBlock.valueHex});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){var e=this.valueBlock.valueHex.byteLength%2?this.valueBlock.valueHex.byteLength+1:this.valueBlock.valueHex.byteLength,r=new t({valueHex:this.valueBlock.valueHex});return r.valueBlock.fromDER(r.valueBlock.valueHex,0,r.valueBlock.valueHex.byteLength,e),r}}],[{key:"blockName",value:function(){return"Integer"}}]),t}(f);t.Integer=O;var U=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"Enumerated"}}]),t}(O);t.Enumerated=U;var H=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).valueDec=(0,oe.getParametersValue)(r,"valueDec",-1),e.isFirstSid=(0,oe.getParametersValue)(r,"isFirstSid",!1),e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===(0,oe.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var i=new Uint8Array(this.valueHex),a=0;a<r&&(i[a]=127&n[a],this.blockLength++,0!=(128&n[a]));a++);for(var o=new ArrayBuffer(this.blockLength),u=new Uint8Array(o),s=0;s<this.blockLength;s++)u[s]=i[s];return this.valueHex=o.slice(0),i=new Uint8Array(this.valueHex),0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===i[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=(0,oe.utilFromBase)(i,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var i=0;i<this.blockLength-1;i++)t[i]=128|n[i];return t[this.blockLength-1]=n[this.blockLength-1],e}var a=(0,oe.utilToBase)(this.valueDec,7);if(0===a.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(e=new ArrayBuffer(a.byteLength),!1===r){var o=new Uint8Array(a);t=new Uint8Array(e);for(var u=0;u<a.byteLength-1;u++)t[u]=128|o[u];t[a.byteLength-1]=o[a.byteLength-1]}return e}},{key:"toString",value:function(){var e="";if(!0===this.isHexOnly)e=(0,oe.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e.isFirstSid=this.isFirstSid,e}}],[{key:"blockName",value:function(){return"sidBlock"}}]),t}(a(n)),L=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).fromString((0,oe.getParametersValue)(r,"value","")),e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var i=new H;if(-1===(n=i.fromBER(e,n,r)))return this.blockLength=0,this.error=i.error,n;0===this.value.length&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=(0,oe.utilConcatBuf)(t,n)}return t}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="",i=!1;do{if(n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1,i){var a=this.value[0],o=0;switch(a.valueDec){case 0:break;case 1:o=40;break;case 2:o=80;break;default:return this.value=[],!1}var u=parseInt(n,10);if(isNaN(u))return!0;a.valueDec=u+o,i=!1}else{var s=new H;if(s.valueDec=parseInt(n,10),isNaN(s.valueDec))return!0;0===this.value.length&&(s.isFirstSid=!0,i=!0),this.value.push(s)}}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(n="{".concat(n,"}"),this.value[r].isFirstSid?e="2.{".concat(n," - 80}"):e+=n):e+=n}return e}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var r=0;r<this.value.length;r++)e.sidArray.push(this.value[r].toJSON());return e}}],[{key:"blockName",value:function(){return"ObjectIdentifierValueBlock"}}]),t}(c),P=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r,L))).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"ObjectIdentifier"}}]),t}(f);t.ObjectIdentifier=P;var I=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).isHexOnly=!0,e.value="",e}return l(t,e),o(t,[{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"Utf8StringValueBlock"}}]),t}(a(n)),T=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=p(this,h(t).call(this,r,I)),"value"in r&&e.fromString(r.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e));try{this.valueBlock.value=decodeURIComponent(escape(this.valueBlock.value))}catch(e){this.warnings.push('Error during "decodeURIComponent": '.concat(e,", using raw string"))}}},{key:"fromString",value:function(e){var t=unescape(encodeURIComponent(e)),r=t.length;this.valueBlock.valueHex=new ArrayBuffer(r);for(var n=new Uint8Array(this.valueBlock.valueHex),i=0;i<r;i++)n[i]=t.charCodeAt(i);this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"Utf8String"}}]),t}(f);t.Utf8String=T;var D=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).valueDec=(0,oe.getParametersValue)(r,"valueDec",-1),e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===(0,oe.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var i=new Uint8Array(this.valueHex),a=0;a<r&&(i[a]=127&n[a],this.blockLength++,0!=(128&n[a]));a++);for(var o=new ArrayBuffer(this.blockLength),u=new Uint8Array(o),s=0;s<this.blockLength;s++)u[s]=i[s];return this.valueHex=o.slice(0),i=new Uint8Array(this.valueHex),0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===i[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=(0,oe.utilFromBase)(i,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var i=0;i<this.blockLength-1;i++)t[i]=128|n[i];return t[this.blockLength-1]=n[this.blockLength-1],e}var a=(0,oe.utilToBase)(this.valueDec,7);if(0===a.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(e=new ArrayBuffer(a.byteLength),!1===r){var o=new Uint8Array(a);t=new Uint8Array(e);for(var u=0;u<a.byteLength-1;u++)t[u]=128|o[u];t[a.byteLength-1]=o[a.byteLength-1]}return e}},{key:"toString",value:function(){return!0===this.isHexOnly?(0,oe.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength):this.valueDec.toString()}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}}],[{key:"blockName",value:function(){return"relativeSidBlock"}}]),t}(a(n)),j=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).fromString((0,oe.getParametersValue)(r,"value","")),e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var i=new D;if(-1===(n=i.fromBER(e,n,r)))return this.blockLength=0,this.error=i.error,n;this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=(0,oe.utilConcatBuf)(t,n)}return t}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="";do{n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1;var i=new D;if(i.valueDec=parseInt(n,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?n="{".concat(n,"}"):n}return e}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var r=0;r<this.value.length;r++)e.sidArray.push(this.value[r].toJSON());return e}}],[{key:"blockName",value:function(){return"RelativeObjectIdentifierValueBlock"}}]),t}(c),_=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r,j))).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"RelativeObjectIdentifier"}}]),t}(f);t.RelativeObjectIdentifier=_;var V=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).isHexOnly=!0,e.value="",e}return l(t,e),o(t,[{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"BmpStringValueBlock"}}]),t}(a(n)),J=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=p(this,h(t).call(this,r,V)),"value"in r&&e.fromString(r.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=2){var i=r[n];r[n]=r[n+1],r[n+1]=i}this.valueBlock.value=String.fromCharCode.apply(null,new Uint16Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(2*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var i=(0,oe.utilToBase)(e.charCodeAt(n),8),a=new Uint8Array(i);if(!(a.length>2))for(var o=2-a.length,u=a.length-1;u>=0;u--)r[2*n+u+o]=a[u]}this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"BmpString"}}]),t}(f);t.BmpString=J;var M=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).isHexOnly=!0,e.value="",e}return l(t,e),o(t,[{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"UniversalStringValueBlock"}}]),t}(a(n)),F=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=p(this,h(t).call(this,r,M)),"value"in r&&e.fromString(r.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=4)r[n]=r[n+3],r[n+1]=r[n+2],r[n+2]=0,r[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(4*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var i=(0,oe.utilToBase)(e.charCodeAt(n),8),a=new Uint8Array(i);if(!(a.length>4))for(var o=4-a.length,u=a.length-1;u>=0;u--)r[4*n+u+o]=a[u]}this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"UniversalString"}}]),t}(f);t.UniversalString=F;var z=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).value="",e.isHexOnly=!0,e}return l(t,e),o(t,[{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"SimpleStringValueBlock"}}]),t}(a(n)),G=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),e=p(this,h(t).call(this,r,z)),"value"in r&&e.fromString(r.value),e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"SIMPLESTRING"}}]),t}(f),q=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"NumericString"}}]),t}(G);t.NumericString=q;var W=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"PrintableString"}}]),t}(G);t.PrintableString=W;var Z=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"TeletexString"}}]),t}(G);t.TeletexString=Z;var $=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"VideotexString"}}]),t}(G);t.VideotexString=$;var X=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"IA5String"}}]),t}(G);t.IA5String=X;var Y=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"GraphicString"}}]),t}(G);t.GraphicString=Y;var Q=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"VisibleString"}}]),t}(G);t.VisibleString=Q;var ee=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"GeneralString"}}]),t}(G);t.GeneralString=ee;var te=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"CharacterString"}}]),t}(G);t.CharacterString=te;var re=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i(this,t),(e=p(this,h(t).call(this,r))).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,"value"in r){e.fromString(r.value),e.valueBlock.valueHex=new ArrayBuffer(r.value.length);for(var n=new Uint8Array(e.valueBlock.valueHex),a=0;a<r.value.length;a++)n[a]=r.value.charCodeAt(a)}return"valueDate"in r&&(e.fromDate(r.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for convertion"}},{key:"toString",value:function(){var e=new Array(7);return e[0]=(0,oe.padNumber)(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=(0,oe.padNumber)(this.month,2),e[2]=(0,oe.padNumber)(this.day,2),e[3]=(0,oe.padNumber)(this.hour,2),e[4]=(0,oe.padNumber)(this.minute,2),e[5]=(0,oe.padNumber)(this.second,2),e[6]="Z",e.join("")}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e}}],[{key:"blockName",value:function(){return"UTCTime"}}]),t}(Q);t.UTCTime=re;var ne=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i(this,t),(e=p(this,h(t).call(this,r))).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,e.millisecond=0,"value"in r){e.fromString(r.value),e.valueBlock.valueHex=new ArrayBuffer(r.value.length);for(var n=new Uint8Array(e.valueBlock.valueHex),a=0;a<r.value.length;a++)n[a]=r.value.charCodeAt(a)}return"valueDate"in r&&(e.fromDate(r.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return l(t,e),o(t,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,n="",i="",a=0,o=0,u=0;if("Z"===e[e.length-1])n=e.substr(0,e.length-1),r=!0;else{var s=new Number(e[e.length-1]);if(isNaN(s.valueOf()))throw new Error("Wrong input string for convertion");n=e}if(r){if(-1!==n.indexOf("+"))throw new Error("Wrong input string for convertion");if(-1!==n.indexOf("-"))throw new Error("Wrong input string for convertion")}else{var c=1,l=n.indexOf("+"),h="";if(-1===l&&(l=n.indexOf("-"),c=-1),-1!==l){if(h=n.substr(l+1),n=n.substr(0,l),2!==h.length&&4!==h.length)throw new Error("Wrong input string for convertion");var f=new Number(h.substr(0,2));if(isNaN(f.valueOf()))throw new Error("Wrong input string for convertion");if(o=c*f,4===h.length){if(f=new Number(h.substr(2,2)),isNaN(f.valueOf()))throw new Error("Wrong input string for convertion");u=c*f}}}var v=n.indexOf(".");if(-1===v&&(v=n.indexOf(",")),-1!==v){var y=new Number("0".concat(n.substr(v)));if(isNaN(y.valueOf()))throw new Error("Wrong input string for convertion");a=y.valueOf(),i=n.substr(0,v)}else i=n;switch(!0){case 8===i.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==v)throw new Error("Wrong input string for convertion");break;case 10===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var p=60*a;this.minute=Math.floor(p),p=60*(p-this.minute),this.second=Math.floor(p),p=1e3*(p-this.second),this.millisecond=Math.floor(p)}break;case 12===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var g=60*a;this.second=Math.floor(g),g=1e3*(g-this.second),this.millisecond=Math.floor(g)}break;case 14===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var m=1e3*a;this.millisecond=Math.floor(m)}break;default:throw new Error("Wrong input string for convertion")}var d=t.exec(i);if(null===d)throw new Error("Wrong input string for convertion");for(var k=1;k<d.length;k++)switch(k){case 1:this.year=parseInt(d[k],10);break;case 2:this.month=parseInt(d[k],10);break;case 3:this.day=parseInt(d[k],10);break;case 4:this.hour=parseInt(d[k],10)+o;break;case 5:this.minute=parseInt(d[k],10)+u;break;case 6:this.second=parseInt(d[k],10);break;default:throw new Error("Wrong input string for convertion")}if(!1===r){var w=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=w.getUTCFullYear(),this.month=w.getUTCMonth(),this.day=w.getUTCDay(),this.hour=w.getUTCHours(),this.minute=w.getUTCMinutes(),this.second=w.getUTCSeconds(),this.millisecond=w.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=[];return e.push((0,oe.padNumber)(this.year,4)),e.push((0,oe.padNumber)(this.month,2)),e.push((0,oe.padNumber)(this.day,2)),e.push((0,oe.padNumber)(this.hour,2)),e.push((0,oe.padNumber)(this.minute,2)),e.push((0,oe.padNumber)(this.second,2)),0!==this.millisecond&&(e.push("."),e.push((0,oe.padNumber)(this.millisecond,3))),e.push("Z"),e.join("")}},{key:"toJSON",value:function(){var e={};try{e=g(h(t.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e.millisecond=this.millisecond,e}}],[{key:"blockName",value:function(){return"GeneralizedTime"}}]),t}(Q);t.GeneralizedTime=ne;var ie=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"DATE"}}]),t}(T);t.DATE=ie;var ae=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"TimeOfDay"}}]),t}(T);t.TimeOfDay=ae;var ue=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"DateTime"}}]),t}(T);t.DateTime=ue;var se=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"Duration"}}]),t}(T);t.Duration=se;var ce=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),(e=p(this,h(t).call(this,r))).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return l(t,e),o(t,null,[{key:"blockName",value:function(){return"TIME"}}]),t}(T);t.TIME=ce;var le=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.value=(0,oe.getParametersValue)(t,"value",[]),this.optional=(0,oe.getParametersValue)(t,"optional",!1)};t.Choice=le;var he=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.name=(0,oe.getParametersValue)(t,"name",""),this.optional=(0,oe.getParametersValue)(t,"optional",!1)};t.Any=he;var fe=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.name=(0,oe.getParametersValue)(t,"name",""),this.optional=(0,oe.getParametersValue)(t,"optional",!1),this.value=(0,oe.getParametersValue)(t,"value",new he),this.local=(0,oe.getParametersValue)(t,"local",!1)};t.Repeated=fe;var ve=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.data=(0,oe.getParametersValue)(t,"data",new ArrayBuffer(0))}return o(e,[{key:"fromBER",value:function(e,t,r){return this.data=e.slice(t,r),t+r}},{key:"toBER",value:function(){return this.data}}]),e}();function ye(e,t,r){var i=t;var a=new f({},Object),o=new n;if(!1===(0,oe.checkBufferParams)(o,e,t,r))return a.error=o.error,{offset:-1,result:a};if(0===new Uint8Array(e,t,r).length)return this.error="Zero buffer length",{offset:-1,result:a};var u=a.idBlock.fromBER(e,t,r);if(a.warnings.concat(a.idBlock.warnings),-1===u)return a.error=a.idBlock.error,{offset:-1,result:a};if(t=u,r-=a.idBlock.blockLength,u=a.lenBlock.fromBER(e,t,r),a.warnings.concat(a.lenBlock.warnings),-1===u)return a.error=a.lenBlock.error,{offset:-1,result:a};if(t=u,r-=a.lenBlock.blockLength,!1===a.idBlock.isConstructed&&!0===a.lenBlock.isIndefiniteForm)return a.error="Indefinite length form used for primitive encoding form",{offset:-1,result:a};var s=f;switch(a.idBlock.tagClass){case 1:if(a.idBlock.tagNumber>=37&&!1===a.idBlock.isHexOnly)return a.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:a};switch(a.idBlock.tagNumber){case 0:if(!0===a.idBlock.isConstructed&&a.lenBlock.length>0)return a.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:a};s=w;break;case 1:s=B;break;case 2:s=O;break;case 3:s=E;break;case 4:s=R;break;case 5:s=S;break;case 6:s=P;break;case 10:s=U;break;case 12:s=T;break;case 13:s=_;break;case 14:s=ce;break;case 15:return a.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:a};case 16:s=A;break;case 17:s=x;break;case 18:s=q;break;case 19:s=W;break;case 20:s=Z;break;case 21:s=$;break;case 22:s=X;break;case 23:s=re;break;case 24:s=ne;break;case 25:s=Y;break;case 26:s=Q;break;case 27:s=ee;break;case 28:s=F;break;case 29:s=te;break;case 30:s=J;break;case 31:s=ie;break;case 32:s=ae;break;case 33:s=ue;break;case 34:s=se;break;default:var c;(c=!0===a.idBlock.isConstructed?new d:new y).idBlock=a.idBlock,c.lenBlock=a.lenBlock,c.warnings=a.warnings,u=(a=c).fromBER(e,t,r)}break;case 2:case 3:case 4:default:s=!0===a.idBlock.isConstructed?d:y}return u=(a=function(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecode=e.valueBeforeDecode.slice(0),r}(a,s)).fromBER(e,t,!0===a.lenBlock.isIndefiniteForm?r:a.lenBlock.length),a.valueBeforeDecode=e.slice(i,i+a.blockLength),{offset:u,result:a}}function pe(e){if(0===e.byteLength){var t=new f({},Object);return t.error="Input buffer has zero length",{offset:-1,result:t}}return ye(e,0,e.byteLength)}function ge(e,t,r){if(r instanceof le){for(var n=0;n<r.value.length;n++){if(!0===ge(e,t,r.value[n]).verified)return{verified:!0,result:e}}var i={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty("name")&&(i.name=r.name),i}if(r instanceof he)return r.hasOwnProperty("name")&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var a=r.idBlock.toBER(!1);if(0===a.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(a,0,a.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if("isHexOnly"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(!0===r.idBlock.isHexOnly){if("valueHex"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var o=new Uint8Array(r.idBlock.valueHex),u=new Uint8Array(t.idBlock.valueHex);if(o.length!==u.length)return{verified:!1,result:e};for(var s=0;s<o.length;s++)if(o[s]!==u[1])return{verified:!1,result:e}}if(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(e[r.name]=t)),!0===r.idBlock.isConstructed){var c=0,l={verified:!1},h=r.valueBlock.value.length;if(h>0&&r.valueBlock.value[0]instanceof fe&&(h=t.valueBlock.value.length),0===h)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var f=!0,v=0;v<r.valueBlock.value.length;v++)f=f&&(r.valueBlock.value[v].optional||!1);return!0===f?{verified:!0,result:e}:(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var y=0;y<h;y++)if(y-c>=t.valueBlock.value.length){if(!1===r.valueBlock.value[y].optional){var p={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],p.name=r.name)),p}}else if(r.valueBlock.value[0]instanceof fe){if(!1===(l=ge(e,t.valueBlock.value[y],r.valueBlock.value[0].value)).verified){if(!0!==r.valueBlock.value[0].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),l;c++}if("name"in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var g={};void 0===(g="local"in r.valueBlock.value[0]&&!0===r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(g[r.valueBlock.value[0].name]=[]),g[r.valueBlock.value[0].name].push(t.valueBlock.value[y])}}else if(!1===(l=ge(e,t.valueBlock.value[y-c],r.valueBlock.value[y])).verified){if(!0!==r.valueBlock.value[y].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),l;c++}if(!1===l.verified){var m={verified:!1,result:e};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],m.name=r.name)),m}return{verified:!0,result:e}}if("primitiveSchema"in r&&"valueHex"in t.valueBlock){var d=pe(t.valueBlock.valueHex);if(-1===d.offset){var k={verified:!1,result:d.result};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],k.name=r.name)),k}return ge(e,d.result,r.primitiveSchema)}return{verified:!0,result:e}}t.RawData=ve})),se=(ae=ue)&&ae.__esModule&&Object.prototype.hasOwnProperty.call(ae,"default")?ae.default:ae,ce=ue.fromBER,le=ue.compareSchema,he=ue.verifySchema,fe=ue.fromJSON,ve=ue.RawData,ye=ue.Repeated,pe=ue.Any,ge=ue.Choice,me=ue.TIME,de=ue.Duration,ke=ue.DateTime,we=ue.TimeOfDay,be=ue.DATE,Be=ue.GeneralizedTime,Ae=ue.UTCTime,xe=ue.CharacterString,Se=ue.GeneralString,Ce=ue.VisibleString,Re=ue.GraphicString,Ne=ue.IA5String,Ee=ue.VideotexString,Ke=ue.TeletexString,Oe=ue.PrintableString,Ue=ue.NumericString,He=ue.UniversalString,Le=ue.BmpString,Pe=ue.RelativeObjectIdentifier,Ie=ue.Utf8String,Te=ue.ObjectIdentifier,De=ue.Enumerated,je=ue.Integer,_e=ue.BitString,Ve=ue.OctetString,Je=ue.Null,Me=ue.Set,Fe=ue.Sequence,ze=ue.Boolean,Ge=ue.EndOfContent,qe=ue.Constructed,We=ue.Primitive,Ze=ue.BaseBlock,$e=ue.ValueBlock,Xe=ue.HexBlock,Ye=Object.freeze({__proto__:null,default:se,__moduleExports:ue,fromBER:ce,compareSchema:le,verifySchema:he,fromJSON:fe,RawData:ve,Repeated:ye,Any:pe,Choice:ge,TIME:me,Duration:de,DateTime:ke,TimeOfDay:we,DATE:be,GeneralizedTime:Be,UTCTime:Ae,CharacterString:xe,GeneralString:Se,VisibleString:Ce,GraphicString:Re,IA5String:Ne,VideotexString:Ee,TeletexString:Ke,PrintableString:Oe,NumericString:Ue,UniversalString:He,BmpString:Le,RelativeObjectIdentifier:Pe,Utf8String:Ie,ObjectIdentifier:Te,Enumerated:De,Integer:je,BitString:_e,OctetString:Ve,Null:Je,Set:Me,Sequence:Fe,Boolean:ze,EndOfContent:Ge,Constructed:qe,Primitive:We,BaseBlock:Ze,ValueBlock:$e,HexBlock:Xe}),Qe={fromASN:function(e){return e instanceof Je?null:e.valueBeforeDecode},toASN:function(e){if(null===e)return new Je;var t=ce(e);if(t.result.error)throw new Error(t.result.error);return t.result}},et={fromASN:function(e){return!e.valueBlock.valueDec&&e.valueBlock.valueHex.byteLength>0?e.valueBlock.toString():e.valueBlock.valueDec},toASN:function(e){return new je({value:e})}},tt={fromASN:function(e){return e.valueBlock.valueDec},toASN:function(e){return new De({value:e})}},rt={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new je({valueHex:e})}},nt={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new _e({valueHex:e})}},it={fromASN:function(e){return e.valueBlock.toString()},toASN:function(e){return new Te({value:e})}},at={fromASN:function(e){return e.valueBlock.value},toASN:function(e){return new ze({value:e})}},ot={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new Ve({valueHex:e})}};function ut(e){return{fromASN:function(e){return e.valueBlock.value},toASN:function(t){return new e({value:t})}}}var st,ct,lt=ut(Ie),ht=ut(Le),ft=ut(He),vt=ut(Ue),yt=ut(Oe),pt=ut(Ke),gt=ut(Ee),mt=ut(Ne),dt=ut(Re),kt=ut(Ce),wt=ut(Se),bt=ut(xe),Bt={fromASN:function(e){return e.toDate()},toASN:function(e){return new Ae({valueDate:e})}},At={fromASN:function(e){return e.toDate()},toASN:function(e){return new Be({valueDate:e})}},xt=Object.freeze({AsnAnyConverter:Qe,AsnIntegerConverter:et,AsnEnumeratedConverter:tt,AsnIntegerArrayBufferConverter:rt,AsnBitStringConverter:nt,AsnObjectIdentifierConverter:it,AsnBooleanConverter:at,AsnOctetStringConverter:ot,AsnUtf8StringConverter:lt,AsnBmpStringConverter:ht,AsnUniversalStringConverter:ft,AsnNumericStringConverter:vt,AsnPrintableStringConverter:yt,AsnTeletexStringConverter:pt,AsnVideotexStringConverter:gt,AsnIA5StringConverter:mt,AsnGraphicStringConverter:dt,AsnVisibleStringConverter:kt,AsnGeneralStringConverter:wt,AsnCharacterStringConverter:bt,AsnUTCTimeConverter:Bt,AsnGeneralizedTimeConverter:At});!function(e){e[e.Sequence=0]="Sequence",e[e.Set=1]="Set",e[e.Choice=2]="Choice"}(st||(st={})),function(e){e[e.Any=0]="Any",e[e.Boolean=1]="Boolean",e[e.OctetString=2]="OctetString",e[e.BitString=3]="BitString",e[e.Integer=4]="Integer",e[e.Enumerated=5]="Enumerated",e[e.ObjectIdentifier=6]="ObjectIdentifier",e[e.Utf8String=7]="Utf8String",e[e.BmpString=8]="BmpString",e[e.UniversalString=9]="UniversalString",e[e.NumericString=10]="NumericString",e[e.PrintableString=11]="PrintableString",e[e.TeletexString=12]="TeletexString",e[e.VideotexString=13]="VideotexString",e[e.IA5String=14]="IA5String",e[e.GraphicString=15]="GraphicString",e[e.VisibleString=16]="VisibleString",e[e.GeneralString=17]="GeneralString",e[e.CharacterString=18]="CharacterString",e[e.UTCTime=19]="UTCTime",e[e.GeneralizedTime=20]="GeneralizedTime",e[e.DATE=21]="DATE",e[e.TimeOfDay=22]="TimeOfDay",e[e.DateTime=23]="DateTime",e[e.Duration=24]="Duration",e[e.TIME=25]="TIME",e[e.Null=26]="Null"}(ct||(ct={}));var St=new(function(){function e(){i(this,e),this.items=new Map}return o(e,[{key:"has",value:function(e){return this.items.has(e)}},{key:"get",value:function(e){var t=this.items.get(e);if(!t)throw new Error("Cannot get schema for current target");return t}},{key:"cache",value:function(e){var t=this.get(e);t.schema||(t.schema=this.create(e,!0))}},{key:"createDefault",value:function(e){var t={type:st.Sequence,items:{}},r=this.findParentSchema(e);return r&&(Object.assign(t,r),t.items=Object.assign({},t.items,r.items)),t}},{key:"create",value:function(e,t){var r=this.items.get(e)||this.createDefault(e),n=[];for(var i in r.items){var a=r.items[i],o=t?i:"",u=void 0;if("number"==typeof a.type){var s=ct[a.type],c=Ye[s];if(!c)throw new Error("Cannot get ASN1 class by name '".concat(s,"'"));u=new c({name:o})}else u=new pe({name:o});var l=!!a.optional||void 0!==a.defaultValue;if(a.repeated&&(u.name="",u=new ye({name:o,value:u})),null!==a.context&&void 0!==a.context)if(a.implicit)if("number"==typeof a.type)n.push(new We({name:o,optional:l,idBlock:{tagClass:3,tagNumber:a.context}}));else{this.cache(a.type);var h=this.get(a.type).schema.valueBlock.value;n.push(new qe({name:o,optional:l,idBlock:{tagClass:3,tagNumber:a.context},value:h}))}else n.push(new qe({optional:l,idBlock:{tagClass:3,tagNumber:a.context},value:[u]}));else u.optional=l,n.push(u)}switch(r.type){case st.Sequence:return new Fe({value:n,name:""});case st.Set:return new Me({value:n,name:""});case st.Choice:return new ge({value:n,name:""});default:throw new Error("Unsupported ASN1 type in use")}}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=e.__proto__;return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}()),Ct=function(e){return function(t){var r=St.get(t);Object.assign(r,e)}},Rt=function(e){return function(t,r){var n;St.has(t.constructor)?n=St.get(t.constructor):(n=St.createDefault(t.constructor),St.set(t.constructor,n));var i=Object.assign({},e);if("number"==typeof i.type&&!i.converter){var a="Asn".concat(ct[e.type],"Converter"),o=xt[a];if(!o)throw new Error("Cannot get '".concat(a,"' for property '").concat(r,"' of ").concat(t.constructor.name));i.converter=o}n.items[r]=i}};function Nt(e){return e&&e.prototype?!(!e.prototype.toASN||!e.prototype.fromASN)||Nt(e.prototype):!!(e&&e.toASN&&e.fromASN)}var Et,Kt=function(){function e(){i(this,e)}return o(e,null,[{key:"parse",value:function(e,t){var r;if(e instanceof ArrayBuffer)r=e;else if(void 0!==("undefined"==typeof Buffer?"undefined":n(Buffer))&&Buffer.isBuffer(e))r=new Uint8Array(e).buffer;else{if(!ArrayBuffer.isView(e))throw new TypeError("Wrong type of 'data' argument");r=e.buffer}var i=ce(r);if(i.result.error)throw new Error(i.result.error);return this.fromASN(i.result,t)}},{key:"fromASN",value:function(e,t){var r=this;if(Nt(t))return(new t).fromASN(e);var n=St.get(t);St.cache(t);var i=n.schema;if(e.constructor===qe&&n.type!==st.Choice)for(var a in i=new qe({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:n.schema.valueBlock.value}),n.items)delete e[a];var o=le(e,e,i);if(!o.verified)throw new Error("Data does not match to ".concat(t.name," ASN1 schema. ").concat(o.result.error));var u=new t,s=function(t){if(!e[t])return"continue";var i=n.items[t];if("number"==typeof i.type){var a=i.converter;if(!a)throw new Error("Converter is empty");if(i.repeated)u[t]=Array.from(e[t],(function(e){return a.fromASN(e)}));else{var o=e[t];if(i.implicit){var s=ct[i.type],c=Ye[s];if(!c)throw new Error("Cannot get '".concat(s,"' class from asn1js module"));var l=new c;l.valueBlock=o.valueBlock,o=ce(l.toBER(!1)).result}u[t]=a.fromASN(o)}}else i.repeated?u[t]=Array.from(e[t],(function(e){return r.fromASN(e,i.type)})):u[t]=r.fromASN(e[t],i.type)};for(var c in n.items)s(c);return u._cache={asn1:e},u}}]),e}(),Ot=function(){function e(){i(this,e)}return o(e,null,[{key:"serialize",value:function(e){return this.toASN(e).toBER(!1)}},{key:"toASN",value:function(e){var t=this;if(e&&Nt(e.constructor))return e.toASN();var r=e.constructor,n=St.get(r);St.cache(r);var i,a=[];for(var o in n.items){var u=n.items[o],s=e[o];if(void 0!==s&&u.defaultValue!==s){var c=void 0;if("number"==typeof u.type?function(){var e=u.converter;if(!e)throw new Error("Property '".concat(o,"' doesn't have converter for type ").concat(ct[u.type]," in schema '").concat(r.name,"'"));c=u.repeated?Array.from(s,(function(t){return e.toASN(t)})):e.toASN(s)}():c=u.repeated?Array.from(s,(function(e){return t.toASN(e)})):this.toASN(s),null!==u.context&&void 0!==u.context)if(u.implicit)if("number"==typeof u.type){var l={};l.valueHex=c.valueBlock.toBER(),a.push(new We(Object.assign({optional:u.optional,idBlock:{tagClass:3,tagNumber:u.context}},l)))}else a.push(new qe({optional:u.optional,idBlock:{tagClass:3,tagNumber:u.context},value:c.valueBlock.value}));else a.push(new qe({optional:u.optional,idBlock:{tagClass:3,tagNumber:u.context},value:[c]}));else u.repeated?a=a.concat(c):a.push(c)}}switch(n.type){case st.Sequence:i=new Fe({value:a});break;case st.Set:i=new Me({value:a});break;case st.Choice:if(!a[0])throw new Error("Schema '".concat(r.name,"' has wrong data. Choice cannot be empty."));i=a[0]}return i}}]),e}(),Ut=function(e){function t(e,r){var n;return i(this,t),(n=p(this,h(t).call(this,r?"".concat(e,". See the inner exception for more details."):e))).message=e,n.innerError=r,n}return l(t,e),t}(y(Error)),Ht=function(e){function t(e,r,n){return i(this,t),p(this,h(t).call(this,e,"JSON doesn't match to '".concat(e.target.name,"' schema. ").concat(r),n))}return l(t,e),t}(function(e){function t(e,r,n){var a;return i(this,t),(a=p(this,h(t).call(this,r,n))).schema=e,a}return l(t,e),t}(Ut)),Lt=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),t}(Ut),Pt=function(e){function t(e,r,n){var a;return i(this,t),(a=p(this,h(t).call(this,"Cannot serialize by '".concat(e,"' schema. ").concat(r),n))).schemaName=e,a}return l(t,e),t}(Ut),It=function(e){function t(e,r){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i(this,t),(n=p(this,h(t).call(this,e,"Some keys doesn't match to schema"))).keys=r,n.errors=a,n}return l(t,e),t}(Ht);function Tt(e,t){if(!function(e,t){switch(t){case Et.Boolean:return"boolean"==typeof e;case Et.Number:return"number"==typeof e;case Et.String:return"string"==typeof e}return!0}(e,t))throw new TypeError("Value must be ".concat(Et[t]))}function Dt(e){return e&&e.prototype?!(!e.prototype.toJSON||!e.prototype.fromJSON)||Dt(e.prototype):!!(e&&e.toJSON&&e.fromJSON)}!function(e){e[e.Any=0]="Any",e[e.Boolean=1]="Boolean",e[e.Number=2]="Number",e[e.String=3]="String"}(Et||(Et={}));var jt=function(){function e(){i(this,e),this.items=new Map}return o(e,[{key:"has",value:function(e){return this.items.has(e)||!!this.findParentSchema(e)}},{key:"get",value:function(e){var t=this.items.get(e)||this.findParentSchema(e);if(!t)throw new Error("Cannot get schema for current target");return t}},{key:"create",value:function(e){var t={names:{}},r=this.findParentSchema(e);if(r)for(var n in Object.assign(t,r),t.names={},r.names)t.names[n]=Object.assign({},r.names[n]);return t.target=e,t}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=e.__proto__;return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}(),_t=new jt,Vt=function(){function e(t){i(this,e),this.pattern=new RegExp(t)}return o(e,[{key:"validate",value:function(e){var t=new RegExp(this.pattern.source,this.pattern.flags);if("string"!=typeof e)throw new Lt("Incoming value must be string");if(!t.exec(e))throw new Lt("Value doesn't match to pattern '".concat(t.toString(),"'"))}}]),e}(),Jt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;i(this,e),this.min=t,this.max=r}return o(e,[{key:"validate",value:function(e){if(Tt(e,Et.Number),!(this.min<=e&&e<=this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new Lt("Value doesn't match to diapason [".concat(t,",").concat(r,"]"))}}}]),e}(),Mt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;i(this,e),this.min=t,this.max=r}return o(e,[{key:"validate",value:function(e){if(Tt(e,Et.Number),!(this.min<e&&e<this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new Lt("Value doesn't match to diapason (".concat(t,",").concat(r,")"))}}}]),e}(),Ft=function(){function e(t,r,n){i(this,e),this.length=t,this.minLength=r,this.maxLength=n}return o(e,[{key:"validate",value:function(e){if(void 0===this.length){if(void 0!==this.minLength&&e.length<this.minLength)throw new Lt("Value length must be more than ".concat(this.minLength,"."));if(void 0!==this.maxLength&&e.length>this.maxLength)throw new Lt("Value length must be less than ".concat(this.maxLength,"."))}else if(e.length!==this.length)throw new Lt("Value length must be exactly ".concat(this.length,"."))}}]),e}(),zt=function(){function e(t){i(this,e),this.enumeration=t}return o(e,[{key:"validate",value:function(e){if(Tt(e,Et.String),!this.enumeration.includes(e))throw new Lt("Value must be one of ".concat(this.enumeration.map((function(e){return"'".concat(e,"'")})).join(", ")))}}]),e}(),Gt=function(){function e(){i(this,e)}return o(e,null,[{key:"checkValues",value:function(e,t){var r=Array.isArray(e)?e:[e],n=!0,i=!1,a=void 0;try{for(var o,u=r[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value,c=!0,l=!1,h=void 0;try{for(var f,v=t.validations[Symbol.iterator]();!(c=(f=v.next()).done);c=!0){var y=f.value;y instanceof Ft&&t.repeated?y.validate(e):y.validate(s)}}catch(e){l=!0,h=e}finally{try{c||null==v.return||v.return()}finally{if(l)throw h}}}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}},{key:"checkTypes",value:function(e,t){if(t.repeated&&!Array.isArray(e))throw new TypeError("Value must be Array");if("number"==typeof t.type){var r=Array.isArray(e)?e:[e],n=!0,i=!1,a=void 0;try{for(var o,u=r[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){Tt(o.value,t.type)}}catch(e){i=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw a}}}}},{key:"getSchemaByName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";return c({},e.names.default,{},e.names[t])}}]),e}(),qt=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),o(t,null,[{key:"serialize",value:function(e,t,r,n){var i=this.toJSON(e,t);return JSON.stringify(i,r,n)}},{key:"toJSON",value:function(e){var t,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.targetSchema,o=i.schemaName||"default";if(Dt(e))return e.toJSON();if(Array.isArray(e)){t=[];var u=!0,s=!1,c=void 0;try{for(var l,h=e[Symbol.iterator]();!(u=(l=h.next()).done);u=!0){var f=l.value;t.push(this.toJSON(f,i))}}catch(e){s=!0,c=e}finally{try{u||null==h.return||h.return()}finally{if(s)throw c}}}else if("object"===n(e)){if(a&&!_t.has(a))throw new Ut("Cannot get schema for `targetSchema` param");if(a=a||e.constructor,_t.has(a)){var v=_t.get(a);t={};var y=this.getSchemaByName(v,o);for(var p in y)try{var g=function(){var n=y[p],i=e[p],u=void 0;if(n.optional&&void 0===i||void 0!==n.defaultValue&&i===n.defaultValue)return"continue";if(!n.optional&&void 0===i)throw new Pt(a.name,"Property '".concat(p,"' is required."));u="number"==typeof n.type?n.converter?n.repeated?i.map((function(t){return n.converter.toJSON(t,e)})):n.converter.toJSON(i,e):i:n.repeated?i.map((function(e){return r.toJSON(e,{schemaName:o})})):r.toJSON(i,{schemaName:o}),r.checkTypes(u,n),r.checkValues(u,n),t[n.name||p]=u}();if("continue"===g)continue}catch(e){throw e instanceof Pt?e:new Pt(v.target.name,"Property '".concat(p,"' is wrong. ").concat(e.message),e)}}else for(var m in t={},e)t[m]=this.toJSON(e[m],{schemaName:o})}else t=e;return t}}]),t}(Gt),Wt=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),o(t,null,[{key:"parse",value:function(e,t){var r=JSON.parse(e);return this.fromJSON(r,t)}},{key:"fromJSON",value:function(e,r){var n=this,i=r.targetSchema,a=r.schemaName||"default",o=new i;if(Dt(o))return o.fromJSON(e);var u=_t.get(i),s=this.getSchemaByName(u,a),l={};for(var h in r.strictProperty&&!Array.isArray(e)&&t.checkStrictProperty(e,s,u),s)try{if("continue"===function(){var t=s[h],i=t.name||h,l=e[i];if(void 0===l&&(t.optional||void 0!==t.defaultValue))return"continue";if(!t.optional&&void 0===l)throw new Ht(u,"Property '".concat(i,"' is required."));if(n.checkTypes(l,t),n.checkValues(l,t),"number"==typeof t.type)t.converter?t.repeated?o[h]=l.map((function(e){return t.converter.fromJSON(e,o)})):o[h]=t.converter.fromJSON(l,o):o[h]=l;else{var f=c({},r,{targetSchema:t.type,schemaName:a});t.repeated?o[h]=l.map((function(e){return n.fromJSON(e,f)})):o[h]=n.fromJSON(l,f)}}())continue}catch(e){if(e instanceof Ht||(e=new Ht(u,"Property '".concat(h,"' is wrong. ").concat(e.message),e)),!r.strictAllKeys)throw e;l[h]=e}var f=Object.keys(l);if(f.length)throw new It(u,f,l);return o}},{key:"checkStrictProperty",value:function(e,t,r){for(var n=Object.keys(e),i=Object.keys(t),a=[],o=0,u=n;o<u.length;o++){var s=u[o];-1===i.indexOf(s)&&a.push(s)}if(a.length)throw new It(r,a)}}]),t}(Gt);function Zt(e){var t=[];return e.pattern&&t.push(new Vt(e.pattern)),e.type!==Et.Number&&e.type!==Et.Any||(void 0===e.minInclusive&&void 0===e.maxInclusive||t.push(new Jt(e.minInclusive,e.maxInclusive)),void 0===e.minExclusive&&void 0===e.maxExclusive||t.push(new Mt(e.minExclusive,e.maxExclusive)),void 0!==e.enumeration&&t.push(new zt(e.enumeration))),(e.type===Et.String||e.repeated||e.type===Et.Any)&&(void 0===e.length&&void 0===e.minLength&&void 0===e.maxLength||t.push(new Ft(e.length,e.minLength,e.maxLength))),t}var $t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var n,i="Cannot set type for ".concat(r," property of ").concat(t.constructor.name," schema");_t.has(t.constructor)?(n=_t.get(t.constructor)).target!==t.constructor&&(n=_t.create(t.constructor),_t.set(t.constructor,n)):(n=_t.create(t.constructor),_t.set(t.constructor,n));var a,o={type:Et.Any,validations:[]},u=Object.assign(o,e);if(u.validations=Zt(u),"number"!=typeof u.type&&!_t.has(u.type)&&!Dt(u.type))throw new Error("".concat(i,". Assigning type doesn't have schema."));a=Array.isArray(e.schema)?e.schema:[e.schema||"default"];var s=!0,c=!1,l=void 0;try{for(var h,f=a[Symbol.iterator]();!(s=(h=f.next()).done);s=!0){var v=h.value;n.names[v]||(n.names[v]={}),n.names[v][r]=u}}catch(e){c=!0,l=e}finally{try{s||null==f.return||f.return()}finally{if(c)throw l}}}},Xt=function e(t){i(this,e),t&&(this.value=t)};X([Rt({type:ct.ObjectIdentifier})],Xt.prototype,"value",void 0),Xt=X([Ct({type:st.Choice})],Xt);var Yt=function e(t){i(this,e),Object.assign(this,t)};X([Rt({type:ct.ObjectIdentifier})],Yt.prototype,"algorithm",void 0),X([Rt({type:ct.Any,optional:!0})],Yt.prototype,"parameters",void 0);var Qt=function e(){i(this,e),this.version=0,this.privateKeyAlgorithm=new Yt,this.privateKey=new ArrayBuffer(0)};X([Rt({type:ct.Integer})],Qt.prototype,"version",void 0),X([Rt({type:Yt})],Qt.prototype,"privateKeyAlgorithm",void 0),X([Rt({type:ct.OctetString})],Qt.prototype,"privateKey",void 0),X([Rt({type:ct.Any,optional:!0})],Qt.prototype,"attributes",void 0);var er=function e(){i(this,e),this.publicKeyAlgorithm=new Yt,this.publicKey=new ArrayBuffer(0)};X([Rt({type:Yt})],er.prototype,"publicKeyAlgorithm",void 0),X([Rt({type:ct.BitString})],er.prototype,"publicKey",void 0);var tr,rr={fromJSON:function(e){return B.FromBase64Url(e)},toJSON:function(e){return B.ToBase64Url(new Uint8Array(e))}};function nr(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new Uint8Array(t.map((function(e){return e.length})).reduce((function(e,t){return e+t}))),i=0;return t.forEach((function(e,t){for(var r=0;r<e.length;r++)n[i+r]=e[r];i+=e.length})),n}!function(e){e.Unknown="Unknown",e.IE="Internet Explorer",e.Safari="Safari",e.Edge="Edge",e.Chrome="Chrome",e.Firefox="Firefox Mozilla",e.Mobile="Mobile"}(tr||(tr={}));var ir={fromASN:function(e){var t=e.valueBlock.valueHex;return new Uint8Array(t)[0]?e.valueBlock.valueHex:e.valueBlock.valueHex.slice(1)},toASN:function(e){var t=new Uint8Array(e)[0]>127?nr(new Uint8Array([0]),new Uint8Array(e)):new Uint8Array(e);return new je({valueHex:new Uint8Array(t).buffer})}},ar=function e(){i(this,e),this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0)};X([Rt({type:ct.Integer,converter:et})],ar.prototype,"version",void 0),X([Rt({type:ct.Integer,converter:ir}),$t({name:"n",converter:rr})],ar.prototype,"modulus",void 0),X([Rt({type:ct.Integer,converter:ir}),$t({name:"e",converter:rr})],ar.prototype,"publicExponent",void 0),X([Rt({type:ct.Integer,converter:ir}),$t({name:"d",converter:rr})],ar.prototype,"privateExponent",void 0),X([Rt({type:ct.Integer,converter:ir}),$t({name:"p",converter:rr})],ar.prototype,"prime1",void 0),X([Rt({type:ct.Integer,converter:ir}),$t({name:"q",converter:rr})],ar.prototype,"prime2",void 0),X([Rt({type:ct.Integer,converter:ir}),$t({name:"dp",converter:rr})],ar.prototype,"exponent1",void 0),X([Rt({type:ct.Integer,converter:ir}),$t({name:"dq",converter:rr})],ar.prototype,"exponent2",void 0),X([Rt({type:ct.Integer,converter:ir}),$t({name:"qi",converter:rr})],ar.prototype,"coefficient",void 0),X([Rt({type:ct.Any,optional:!0})],ar.prototype,"otherPrimeInfos",void 0);var or=function e(){i(this,e),this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0)};X([Rt({type:ct.Integer,converter:ir}),$t({name:"n",converter:rr})],or.prototype,"modulus",void 0),X([Rt({type:ct.Integer,converter:ir}),$t({name:"e",converter:rr})],or.prototype,"publicExponent",void 0);var ur=function(){function e(t){i(this,e),this.value=new ArrayBuffer(0),t&&(this.value=t)}return o(e,[{key:"toJSON",value:function(){var e=new Uint8Array(this.value);if(4!==e[0])throw new x("Wrong ECPoint. Current version supports only Uncompressed (0x04) point");var t=(e=new Uint8Array(this.value.slice(1))).length/2;return{x:B.ToBase64Url(e.buffer.slice(0,0+t)),y:B.ToBase64Url(e.buffer.slice(0+t,0+t+t))}}},{key:"fromJSON",value:function(e){if(!("x"in e))throw new Error("x: Missing required property");if(!("y"in e))throw new Error("y: Missing required property");var t=B.FromBase64Url(e.x),r=B.FromBase64Url(e.y),n=nr(new Uint8Array([4]),new Uint8Array(t),new Uint8Array(r));return this.value=new Uint8Array(n).buffer,this}}]),e}();X([Rt({type:ct.OctetString})],ur.prototype,"value",void 0),ur=X([Ct({type:st.Choice})],ur);var sr=function(){function e(){i(this,e),this.version=1,this.privateKey=new ArrayBuffer(0)}return o(e,[{key:"fromJSON",value:function(e){if(!("d"in e))throw new Error("d: Missing required property");if(this.privateKey=B.FromBase64Url(e.d),"x"in e){var t=new ur;t.fromJSON(e),this.publicKey=Ot.toASN(t).valueBlock.valueHex}return this}},{key:"toJSON",value:function(){var e={};return e.d=B.ToBase64Url(this.privateKey),this.publicKey&&Object.assign(e,new ur(this.publicKey).toJSON()),e}}]),e}();X([Rt({type:ct.Integer,converter:et})],sr.prototype,"version",void 0),X([Rt({type:ct.OctetString})],sr.prototype,"privateKey",void 0),X([Rt({context:0,type:ct.Any,optional:!0})],sr.prototype,"parameters",void 0),X([Rt({context:1,type:ct.BitString,optional:!0})],sr.prototype,"publicKey",void 0);var cr={fromASN:function(e){var t=new Uint8Array(e.valueBlock.valueHex);return 0===t[0]?t.buffer.slice(1):t.buffer},toASN:function(e){var t=new Uint8Array(e);if(t[0]>127){var r=new Uint8Array(t.length+1);return r.set(t,1),new je({valueHex:r})}return new je({valueHex:e})}},lr=function e(){i(this,e),this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0)};X([Rt({type:ct.Integer,converter:cr})],lr.prototype,"r",void 0),X([Rt({type:ct.Integer,converter:cr})],lr.prototype,"s",void 0);var hr=function(){function e(){i(this,e)}return o(e,null,[{key:"log",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.enabled&&console.log.apply(console,arguments)}},{key:"error",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.enabled&&console.error.apply(console,arguments)}},{key:"info",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.enabled&&console.info.apply(console,arguments)}},{key:"warn",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.enabled&&console.warn.apply(console,arguments)}},{key:"trace",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.enabled&&console.trace.apply(console,arguments)}},{key:"enabled",get:function(){return"undefined"!=typeof self&&self.PV_WEBCRYPTO_LINER_LOG}}]),e}(),fr=function(e){function t(e,r,n,a){var o;return i(this,t),(o=p(this,h(t).call(this))).extractable=r,o.type=n,o.usages=a,o.algorithm=Object.assign({},e),o}return l(t,e),t}(z);function vr(e,t){return e.name.toUpperCase()===t.toUpperCase()}var yr=function(e){function t(e,r,n,a){var o;return i(this,t),(o=p(this,h(t).call(this,e,r,"secret",n))).raw=a,o}return l(t,e),o(t,[{key:"toJSON",value:function(){return{kty:"oct",alg:this.getJwkAlgorithm(),k:B.ToBase64Url(this.raw),ext:this.extractable,key_ops:this.usages}}},{key:"getJwkAlgorithm",value:function(){switch(this.algorithm.name.toUpperCase()){case"AES-CBC":return"A".concat(this.algorithm.length,"CBC");case"AES-CTR":return"A".concat(this.algorithm.length,"CTR");case"AES-GCM":return"A".concat(this.algorithm.length,"GCM");case"AES-ECB":return"A".concat(this.algorithm.length,"ECB");default:throw new S("Unsupported algorithm name")}}}]),t}(fr),pr=function(){function r(){i(this,r)}return o(r,null,[{key:"checkCryptoKey",value:function(e){if(!(e instanceof yr))throw new TypeError("key: Is not AesCryptoKey")}},{key:"generateKey",value:function(t,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=e.nativeCrypto.getRandomValues(new Uint8Array(t.length/8)),i.abrupt("return",new yr(t,r,n,a));case 2:case"end":return i.stop()}}),i)})))}},{key:"encrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,A.toUint8Array(r),!0));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"decrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,A.toUint8Array(r),!1));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"exportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e,r.next="jwk"===r.t0?3:"raw"===r.t0?4:5;break;case 3:return r.abrupt("return",t.toJSON());case 4:return r.abrupt("return",t.raw.buffer);case 5:throw new R("format: Must be 'jwk' or 'raw'");case 6:case"end":return r.stop()}}),r)})))}},{key:"importKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=E(t)?B.FromBase64Url(t.k):A.toArrayBuffer(t),e.t0=a.byteLength<<3,e.next=128===e.t0?4:192===e.t0?4:256===e.t0?4:5;break;case 4:return e.abrupt("break",6);case 5:throw new R("keyData: Is wrong key length");case 6:return o=new yr({name:r.name,length:a.byteLength<<3},n,i,new Uint8Array(a)),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))}},{key:"cipher",value:function(e,n,i,a){return Y(this,void 0,void 0,regeneratorRuntime.mark((function o(){var u,s,c,l,h,f;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(u=a?"encrypt":"decrypt",!vr(e,r.AesCBC)){o.next=6;break}c=A.toUint8Array(e.iv),s=t.AES_CBC[u](i,n.raw,void 0,c),o.next=18;break;case 6:if(!vr(e,r.AesGCM)){o.next=13;break}l=A.toUint8Array(e.iv),e.additionalData&&(h=A.toArrayBuffer(e.additionalData)),f=(e.tagLength||128)/8,s=t.AES_GCM[u](i,n.raw,l,h,f),o.next=18;break;case 13:if(!vr(e,r.AesECB)){o.next=17;break}s=t.AES_ECB[u](i,n.raw,!0),o.next=18;break;case 17:throw new R("algorithm: Is not recognized");case 18:return o.abrupt("return",A.toArrayBuffer(s));case 19:case"end":return o.stop()}}),o)})))}}]),r}();pr.AesCBC="AES-CBC",pr.AesECB="AES-ECB",pr.AesGCM="AES-GCM";var gr=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),o(t,[{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",pr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",pr.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",pr.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",pr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",pr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,r){g(h(t.prototype),"checkCryptoKey",this).call(this,e,r),pr.checkCryptoKey(e)}}]),t}(U),mr=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),o(t,[{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",pr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",pr.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",pr.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",pr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",pr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,r){g(h(t.prototype),"checkCryptoKey",this).call(this,e,r),pr.checkCryptoKey(e)}}]),t}(L),dr=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),o(t,[{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",pr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onEncrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",pr.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",pr.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",pr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",pr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,r){g(h(t.prototype),"checkCryptoKey",this).call(this,e,r),pr.checkCryptoKey(e)}}]),t}(P),kr=function(e){function r(){return i(this,r),p(this,h(r).apply(this,arguments))}return l(r,e),o(r,[{key:"onEncrypt",value:function(e,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=new t.AES_CTR(r.raw,A.toUint8Array(e.counter)).encrypt(A.toUint8Array(n)),i.abrupt("return",A.toArrayBuffer(a));case 2:case"end":return i.stop()}}),i)})))}},{key:"onDecrypt",value:function(e,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=new t.AES_CTR(r.raw,A.toUint8Array(e.counter)).decrypt(A.toUint8Array(n)),i.abrupt("return",A.toArrayBuffer(a));case 2:case"end":return i.stop()}}),i)})))}},{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",pr.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",pr.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",pr.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"checkCryptoKey",value:function(e,t){g(h(r.prototype),"checkCryptoKey",this).call(this,e,t),pr.checkCryptoKey(e)}}]),r}(H),wr=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),o(t,[{key:"onEncrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onDecrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})))}},{key:"checkCryptoKey",value:function(e,r){g(h(t.prototype),"checkCryptoKey",this).call(this,e,r),pr.checkCryptoKey(e)}}]),t}(I),br=function(e){function t(e,r,n,a,o){var u;return i(this,t),(u=p(this,h(t).call(this,e,r,n,a))).data=o,u}return l(t,e),t}(fr),Br=function(){function t(){i(this,t)}return o(t,null,[{key:"checkCryptoKey",value:function(e){if(!(e instanceof br))throw new TypeError("key: Is not RsaCryptoKey")}},{key:"generateKey",value:function(t,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o,u,s,c,l,h,f=this;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a={name:"RSA-PSS",hash:"SHA-256",publicExponent:t.publicExponent,modulusLength:t.modulusLength},i.next=3,e.nativeSubtle.generateKey(a,!0,["sign","verify"]);case 3:return o=i.sent,u=new Qn,i.next=7,u.subtle.exportKey("pkcs8",o.privateKey);case 7:return s=i.sent,i.next=10,u.subtle.importKey("pkcs8",s,t,r,n.filter((function(e){return f.privateUsages.includes(e)})));case 10:return c=i.sent,i.next=13,u.subtle.exportKey("spki",o.publicKey);case 13:return l=i.sent,i.next=16,u.subtle.importKey("spki",l,t,!0,n.filter((function(e){return f.publicUsages.includes(e)})));case 16:return h=i.sent,i.abrupt("return",{privateKey:c,publicKey:h});case 18:case"end":return i.stop()}}),i)})))}},{key:"exportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e,r.next="pkcs8"===r.t0?3:"spki"===r.t0?4:"jwk"===r.t0?5:6;break;case 3:return r.abrupt("return",this.exportPkcs8Key(t));case 4:return r.abrupt("return",this.exportSpkiKey(t));case 5:return r.abrupt("return",this.exportJwkKey(t));case 6:throw new R("format: Must be 'jwk', 'pkcs8' or 'spki'");case 7:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o,u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.t0=e,a.next="pkcs8"===a.t0?3:"spki"===a.t0?5:"jwk"===a.t0?7:9;break;case 3:return o=this.importPkcs8Key(t),a.abrupt("break",10);case 5:return o=this.importSpkiKey(t),a.abrupt("break",10);case 7:return o=this.importJwkKey(t),a.abrupt("break",10);case 9:throw new R("format: Must be 'jwk', 'pkcs8' or 'spki'");case 10:return u=new br(Object.assign({publicExponent:1===o[1][1]?o[1].slice(1):o[1].slice(3),modulusLength:o[0].byteLength<<3},r),n,2===o.length?"public":"private",i,o),a.abrupt("return",u);case 12:case"end":return a.stop()}}),a,this)})))}},{key:"randomNonZeroValues",value:function(t){return(t=e.nativeCrypto.getRandomValues(t)).map((function(t){for(;!t;)t=e.nativeCrypto.getRandomValues(new Uint8Array(1))[0];return t}))}},{key:"exportPkcs8Key",value:function(e){var t=new Qt;return t.privateKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",t.privateKeyAlgorithm.parameters=null,t.privateKey=Ot.serialize(this.exportAsmKey(e.data)),Ot.serialize(t)}},{key:"importPkcs8Key",value:function(e){var t=Kt.parse(e,Qt),r=Kt.parse(t.privateKey,ar);return this.importAsmKey(r)}},{key:"importSpkiKey",value:function(e){var t=Kt.parse(e,er),r=Kt.parse(t.publicKey,or);return this.importAsmKey(r)}},{key:"exportSpkiKey",value:function(e){var t=new or;t.modulus=e.data[0].buffer,t.publicExponent=1===e.data[1][1]?e.data[1].buffer.slice(1):e.data[1].buffer.slice(3);var r=new er;return r.publicKeyAlgorithm.algorithm="1.2.840.113549.1.1.1",r.publicKeyAlgorithm.parameters=null,r.publicKey=Ot.serialize(t),Ot.serialize(r)}},{key:"importJwkKey",value:function(e){var t;return t=e.d?Wt.fromJSON(e,{targetSchema:ar}):Wt.fromJSON(e,{targetSchema:or}),this.importAsmKey(t)}},{key:"exportJwkKey",value:function(e){var t=this.exportAsmKey(e.data),r=qt.toJSON(t);return r.ext=!0,r.key_ops=e.usages,r.kty="RSA",r.alg=this.getJwkAlgorithm(e.algorithm),r}},{key:"getJwkAlgorithm",value:function(e){switch(e.name.toUpperCase()){case"RSA-OAEP":var t=/(\d+)$/.exec(e.hash.name)[1];return"RSA-OAEP".concat("1"!==t?"-".concat(t):"");case"RSASSA-PKCS1-V1_5":return"RS".concat(/(\d+)$/.exec(e.hash.name)[1]);case"RSA-PSS":return"PS".concat(/(\d+)$/.exec(e.hash.name)[1]);case"RSAES-PKCS1-V1_5":return"PS1";default:throw new R("algorithm: Is not recognized")}}},{key:"exportAsmKey",value:function(e){var t;if(e.length>2){var r=new ar;r.privateExponent=e[2].buffer,r.prime1=e[3].buffer,r.prime2=e[4].buffer,r.exponent1=e[5].buffer,r.exponent2=e[6].buffer,r.coefficient=e[7].buffer,t=r}else t=new or;return t.modulus=e[0].buffer,t.publicExponent=1===e[1][1]?e[1].buffer.slice(1):e[1].buffer.slice(3),t}},{key:"importAsmKey",value:function(e){var t=new Uint8Array(4-e.publicExponent.byteLength),r=[new Uint8Array(e.modulus),nr(t,new Uint8Array(e.publicExponent))];return e instanceof ar&&(r.push(new Uint8Array(e.privateExponent)),r.push(new Uint8Array(e.prime1)),r.push(new Uint8Array(e.prime2)),r.push(new Uint8Array(e.exponent1)),r.push(new Uint8Array(e.exponent2)),r.push(new Uint8Array(e.coefficient))),r}}]),t}();Br.RsaSsa="RSASSA-PKCS1-v1_5",Br.RsaPss="RSA-PSS",Br.RsaOaep="RSA-OAEP",Br.privateUsages=["sign","decrypt","unwrapKey"],Br.publicUsages=["verify","encrypt","wrapKey"];var Ar=function(){function e(){i(this,e)}return o(e,null,[{key:"getDigest",value:function(e){switch(e){case"SHA-1":return new t.Sha1;case"SHA-256":return new t.Sha256;case"SHA-512":return new t.Sha512;default:throw new S("keyAlgorithm.hash: Is not recognized")}}},{key:"digest",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=this.getDigest(e.name),i=n.process(A.toUint8Array(t)).finish().result,r.abrupt("return",A.toArrayBuffer(i));case 3:case"end":return r.stop()}}),r,this)})))}}]),e}(),xr=function(e){function r(){return i(this,r),p(this,h(r).apply(this,arguments))}return l(r,e),o(r,[{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Br.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Br.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Br.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onEncrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"onDecrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"checkCryptoKey",value:function(e,t){g(h(r.prototype),"checkCryptoKey",this).call(this,e,t),Br.checkCryptoKey(e)}},{key:"cipher",value:function(e,r,n){var i,a=Ar.getDigest(r.algorithm.hash.name);e.label&&(i=A.toUint8Array(e.label));var o,u=new t.RSA_OAEP(r.data,a,i),s=A.toUint8Array(n);return o="public"===r.type?u.encrypt(s):u.decrypt(s),A.toArrayBuffer(o)}}]),r}(V),Sr=function(e){function r(){return i(this,r),p(this,h(r).apply(this,arguments))}return l(r,e),o(r,[{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Br.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Br.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Br.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onSign",value:function(e,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=new t.RSA_PSS(r.data,Ar.getDigest(r.algorithm.hash.name),e.saltLength),o=a.sign(A.toUint8Array(n)),i.abrupt("return",A.toArrayBuffer(o));case 3:case"end":return i.stop()}}),i)})))}},{key:"onVerify",value:function(e,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:o=new t.RSA_PSS(r.data,Ar.getDigest(r.algorithm.hash.name),e.saltLength),a.prev=1,o.verify(A.toUint8Array(n),A.toUint8Array(i)),a.next=8;break;case 5:return a.prev=5,a.t0=a.catch(1),a.abrupt("return",!1);case 8:return a.abrupt("return",!0);case 9:case"end":return a.stop()}}),a,null,[[1,5]])})))}},{key:"checkCryptoKey",value:function(e,t){g(h(r.prototype),"checkCryptoKey",this).call(this,e,t),Br.checkCryptoKey(e)}}]),r}(_),Cr=function(e){function r(){return i(this,r),p(this,h(r).apply(this,arguments))}return l(r,e),o(r,[{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Br.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Br.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Br.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onSign",value:function(e,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new t.RSA_PKCS1_v1_5(r.data,Ar.getDigest(r.algorithm.hash.name)),a=i.sign(A.toUint8Array(n)),e.abrupt("return",A.toArrayBuffer(a));case 3:case"end":return e.stop()}}),e)})))}},{key:"onVerify",value:function(e,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new t.RSA_PKCS1_v1_5(r.data,Ar.getDigest(r.algorithm.hash.name)),e.prev=1,a.verify(A.toUint8Array(n),A.toUint8Array(i)),e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(1),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,null,[[1,5]])})))}},{key:"checkCryptoKey",value:function(e,t){g(h(r.prototype),"checkCryptoKey",this).call(this,e,t),Br.checkCryptoKey(e)}}]),r}(j),Rr=function(e){function r(){var e;return i(this,r),(e=p(this,h(r).apply(this,arguments))).name="RSAES-PKCS1-v1_5",e.usages={publicKey:["encrypt","wrapKey"],privateKey:["decrypt","unwrapKey"]},e.hashAlgorithms=["SHA-1","SHA-256","SHA-384","SHA-512"],e}return l(r,e),o(r,[{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Br.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkGenerateKeyParams",value:function(e){if(this.checkRequiredProperty(e,"publicExponent"),!(e.publicExponent&&e.publicExponent instanceof Uint8Array))throw new TypeError("publicExponent: Missing or not a Uint8Array");var t=B.ToBase64(e.publicExponent);if("Aw=="!==t&&"AQAB"!==t)throw new TypeError("publicExponent: Must be [3] or [1,0,1]");switch(this.checkRequiredProperty(e,"modulusLength"),e.modulusLength){case 1024:case 2048:case 4096:break;default:throw new TypeError("modulusLength: Must be 1024, 2048, or 4096")}}},{key:"onDecrypt",value:function(e,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=new t.RSA(r.data).decrypt(new t.BigNumber(A.toUint8Array(n))).result,a=r.algorithm.modulusLength>>3,n.byteLength===a){e.next=4;break}throw new x("Decryption error. Encrypted message size doesn't match to key length");case 4:if(o=0,!i[o++]&&2===i[o++]){e.next=7;break}throw new x("Decryption error");case 7:if(0!==i[o++]){e.next=9;break}return e.abrupt("break",10);case 9:if(o<i.length){e.next=7;break}case 10:if(!(o<11)){e.next=12;break}throw new x("Decryption error. PS is less than 8 octets.");case 12:if(o!==i.length){e.next=14;break}throw new x("Decryption error. There is no octet with hexadecimal value 0x00 to separate PS from M");case 14:return e.abrupt("return",i.buffer.slice(o));case 15:case"end":return e.stop()}}),e)})))}},{key:"onEncrypt",value:function(e,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,a,o,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.algorithm.modulusLength>>3,!(n.byteLength>i-11)){e.next=3;break}throw new x("Message too long");case 3:return a=i-n.byteLength-3,o=Br.randomNonZeroValues(new Uint8Array(a)),(u=new Uint8Array(i))[0]=0,u[1]=2,u.set(o,2),u[2+a]=0,u.set(new Uint8Array(n),3+a),s=new t.RSA(r.data).encrypt(new t.BigNumber(u)).result,e.abrupt("return",A.toArrayBuffer(s));case 13:case"end":return e.stop()}}),e)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Br.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Br.importKey(e,t,Object.assign(Object.assign({},r),{name:this.name}),n,i);case 2:return o=a.sent,a.abrupt("return",o);case 4:case"end":return a.stop()}}),a,this)})))}},{key:"checkCryptoKey",value:function(e,t){g(h(r.prototype),"checkCryptoKey",this).call(this,e,t),Br.checkCryptoKey(e)}},{key:"prepareSignData",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=new Qn,r.abrupt("return",n.subtle.digest(e.hash,t));case 2:case"end":return r.stop()}}),r)})))}}]),r}(K),Nr={"1.2.840.10045.3.1.7":"P-256","P-256":"1.2.840.10045.3.1.7","1.3.132.0.34":"P-384","P-384":"1.3.132.0.34","1.3.132.0.35":"P-521","P-521":"1.3.132.0.35","1.3.132.0.10":"K-256","K-256":"1.3.132.0.10"};function Er(e){var t=Nr[e];if(!t)throw new R("Cannot convert WebCrypto named curve '".concat(e,"' to OID"));return t}var Kr=function(e){function t(e,r,n,a,o){var u;return i(this,t),(u=p(this,h(t).call(this,e,r,n,a))).data=o,u}return l(t,e),t}(fr),Or=function(){function e(){i(this,e)}return o(e,null,[{key:"checkLib",value:function(){if(void 0===r)throw new R("Cannot implement EC mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/elliptic.js' script to your project")}},{key:"generateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){var i,a,o,u,s=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkLib(),i=this.initEcKey(e.namedCurve),(a=i.genKeyPair()).getPublic(),o=new Kr(Object.assign({},e),t,"private",r.filter((function(e){return~s.privateUsages.indexOf(e)})),a),u=new Kr(Object.assign({},e),!0,"public",r.filter((function(e){return~s.publicUsages.indexOf(e)})),a),n.abrupt("return",{privateKey:o,publicKey:u});case 7:case"end":return n.stop()}}),n,this)})))}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof Kr))throw new TypeError("key: Is not EcCryptoKey")}},{key:"concat",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=new Uint8Array(t.map((function(e){return e.length})).reduce((function(e,t){return e+t}))),i=0;return t.forEach((function(e,t){for(var r=0;r<e.length;r++)n[i+r]=e[r];i+=e.length})),n}},{key:"exportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this.checkLib(),r.t0=e,r.next="pkcs8"===r.t0?4:"spki"===r.t0?5:"jwk"===r.t0?6:"raw"===r.t0?7:8;break;case 4:return r.abrupt("return",this.exportPkcs8Key(t));case 5:return r.abrupt("return",this.exportSpkiKey(t));case 6:return r.abrupt("return",this.exportJwkKey(t));case 7:return r.abrupt("return",new Uint8Array(t.data.getPublic("der")).buffer);case 8:throw new R("format: Must be 'jwk', 'raw, 'pkcs8' or 'spki'");case 9:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o,u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:this.checkLib(),a.t0=e,a.next="pkcs8"===a.t0?4:"spki"===a.t0?6:"raw"===a.t0?8:"jwk"===a.t0?10:12;break;case 4:return o=this.importPkcs8Key(t,r.namedCurve),a.abrupt("break",13);case 6:return o=this.importSpkiKey(t,r.namedCurve),a.abrupt("break",13);case 8:return o=this.importEcKey(new ur(t),r.namedCurve),a.abrupt("break",13);case 10:return o=this.importJwkKey(t),a.abrupt("break",13);case 12:throw new R("format: Must be 'jwk', 'raw', 'pkcs8' or 'spki'");case 13:return u=new Kr(Object.assign({},r),n,o.priv?"private":"public",i,o),a.abrupt("return",u);case 15:case"end":return a.stop()}}),a,this)})))}},{key:"getNamedCurve",value:function(e){var t=e.toUpperCase(),r="";if(["P-256","P-384","P-521"].indexOf(t)>-1)r=t.replace("-","").toLowerCase();else{if("K-256"!==t)throw new R("Unsupported named curve '".concat(e,"'"));r="secp256k1"}return r}},{key:"initEcKey",value:function(e){return r.ec(this.getNamedCurve(e))}},{key:"exportPkcs8Key",value:function(e){var t=new Qt;return t.privateKeyAlgorithm.algorithm=this.ASN_ALGORITHM,t.privateKeyAlgorithm.parameters=Ot.serialize(new Xt(Er(e.algorithm.namedCurve))),t.privateKey=Ot.serialize(this.exportEcKey(e)),Ot.serialize(t)}},{key:"importPkcs8Key",value:function(e,t){var r=Kt.parse(e,Qt),n=Kt.parse(r.privateKey,sr);return this.importEcKey(n,t)}},{key:"importSpkiKey",value:function(e,t){var r=Kt.parse(e,er),n=new ur(r.publicKey);return this.importEcKey(n,t)}},{key:"exportSpkiKey",value:function(e){var t=new ur(new Uint8Array(e.data.getPublic("der")).buffer),r=new er;return r.publicKeyAlgorithm.algorithm=this.ASN_ALGORITHM,r.publicKeyAlgorithm.parameters=Ot.serialize(new Xt(Er(e.algorithm.namedCurve))),r.publicKey=t.value,Ot.serialize(r)}},{key:"importJwkKey",value:function(e){var t;return t=e.d?Wt.fromJSON(e,{targetSchema:sr}):Wt.fromJSON(e,{targetSchema:ur}),this.importEcKey(t,e.crv)}},{key:"exportJwkKey",value:function(e){var t=this.exportEcKey(e),r=qt.toJSON(t);return r.ext=!0,r.key_ops=e.usages,r.crv=e.algorithm.namedCurve,r.kty="EC",r}},{key:"exportEcKey",value:function(e){if("private"===e.type){var t=new sr,r=new Uint8Array(e.data.getPrivate("der").toArray()),n=new Uint8Array(this.getPointSize(e.algorithm.namedCurve)-r.length);return t.privateKey=nr(n,r),t.publicKey=new Uint8Array(e.data.getPublic("der")),t}if(e.data.pub)return new ur(new Uint8Array(e.data.getPublic("der")).buffer);throw new Error("Cannot get private or public key")}},{key:"importEcKey",value:function(e,t){var r=this.initEcKey(t);return e instanceof ur?r.keyFromPublic(new Uint8Array(e.value)):r.keyFromPrivate(new Uint8Array(e.privateKey))}},{key:"getPointSize",value:function(e){switch(e){case"P-256":case"K-256":return 32;case"P-384":return 48;case"P-521":return 66}throw new Error("namedCurve: Is not recognized")}}]),e}();Or.privateUsages=["sign","deriveKey","deriveBits"],Or.publicUsages=["verify"],Or.ASN_ALGORITHM="1.2.840.10045.2.1";var Ur=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),o(t,[{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Or.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Or.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Or.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onDeriveBits",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){var i,a,o,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Or.checkLib(),i=t.data.derive(e.public.data.getPublic()),a=new Uint8Array(i.toArray()),o=(o=a.length)>32?o>48?66:48:32,a.length<o&&(a=Or.concat(new Uint8Array(o-a.length),a)),u=a.slice(0,r/8).buffer,n.abrupt("return",u);case 8:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,r){g(h(t.prototype),"checkCryptoKey",this).call(this,e,r),Or.checkCryptoKey(e)}}]),t}(G);function Hr(e){for(var t=new Uint8Array(e),r=[],n=0;n<t.length;n++)r.push(t[n]);return r}function Lr(e,t){e.length%2&&(e="0"+e);for(var r=new Uint8Array(e.length/2),n=0;n<e.length;n++){var i=e.slice(n,++n+1);r[(n-1)/2]=parseInt(i,16)}if(t){var a=r.length;a=a>32?a>48?66:48:32,r.length<a&&(r=Or.concat(new Uint8Array(a-r.length),r))}return r}function Pr(e,t){for(var r="",n=0;n<e.length;n++){var i=e[n].toString(16);r+=i.length%2?"0"+i:i}if(t){var a=e.length;a=a>32?a>48?66:48:32,r.length/2<a&&(r=new Array(2*a-r.length+1).join("0")+r)}return r}var Ir=function(e){function t(){return i(this,t),p(this,h(t).apply(this,arguments))}return l(t,e),o(t,[{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Or.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Or.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Or.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onSign",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){var i,a,o,u,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Or.checkLib(),i=new Qn,n.next=4,i.subtle.digest(e.hash,r);case 4:return o=n.sent,a=Hr(o),n.next=8,t.data.sign(a);case 8:return u=n.sent,s=Pr(u.r.toArray(),!0)+Pr(u.s.toArray(),!0),n.abrupt("return",Lr(s).buffer);case 11:case"end":return n.stop()}}),n)})))}},{key:"onVerify",value:function(e,t,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o,u,s;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return Or.checkLib(),a=new Qn,o={r:new Uint8Array(r.slice(0,r.byteLength/2)),s:new Uint8Array(r.slice(r.byteLength/2))},i.next=5,a.subtle.digest(e.hash,n);case 5:return u=i.sent,s=Hr(u),i.abrupt("return",t.data.verify(s,o));case 8:case"end":return i.stop()}}),i)})))}},{key:"checkCryptoKey",value:function(e,r){g(h(t.prototype),"checkCryptoKey",this).call(this,e,r),Or.checkCryptoKey(e)}}]),t}(M),Tr=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="SHA-1",e.usages=[],e}return l(t,e),o(t,[{key:"onDigest",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Ar.digest(e,t));case 1:case"end":return r.stop()}}),r)})))}}]),t}(K),Dr=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="SHA-256",e}return l(t,e),t}(Tr),jr=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).name="SHA-512",e}return l(t,e),t}(Tr),_r=function(e){function t(e,r,n,a){var o;return i(this,t),(o=p(this,h(t).call(this,e,r,"secret",n))).raw=a,o}return l(t,e),t}(fr),Vr=function(e){function r(){return i(this,r),p(this,h(r).apply(this,arguments))}return l(r,e),o(r,[{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new _r(r,n,i,A.toUint8Array(t)));case 1:case"end":return e.stop()}}),e)})))}},{key:"onDeriveBits",value:function(e,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:o=A.toUint8Array(e.salt),u=r.raw,i.t0=e.hash.name.toUpperCase(),i.next="SHA-1"===i.t0?5:"SHA-256"===i.t0?7:"SHA-512"===i.t0?9:11;break;case 5:return a=t.Pbkdf2HmacSha1(u,o,e.iterations,n>>3),i.abrupt("break",12);case 7:return a=t.Pbkdf2HmacSha256(u,o,e.iterations,n>>3),i.abrupt("break",12);case 9:return a=t.Pbkdf2HmacSha512(u,o,e.iterations,n>>3),i.abrupt("break",12);case 11:throw new R("algorithm.hash: '".concat(e.hash.name,"' hash algorithm is not supported"));case 12:return i.abrupt("return",A.toArrayBuffer(a));case 13:case"end":return i.stop()}}),i)})))}},{key:"checkCryptoKey",value:function(e,t){if(g(h(r.prototype),"checkCryptoKey",this).call(this,e,t),!(e instanceof _r))throw new TypeError("key: Is not PbkdfCryptoKey")}}]),r}(W),Jr=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24],Mr=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11],Fr=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7],zr={readUInt32BE:function(e,t){return(e[0+t]<<24|e[1+t]<<16|e[2+t]<<8|e[3+t])>>>0},writeUInt32BE:function(e,t,r){e[0+r]=t>>>24,e[1+r]=t>>>16&255,e[2+r]=t>>>8&255,e[3+r]=255&t},ip:function(e,t,r,n){for(var i=0,a=0,o=6;o>=0;o-=2){for(var u=0;u<=24;u+=8)i<<=1,i|=t>>>u+o&1;for(u=0;u<=24;u+=8)i<<=1,i|=e>>>u+o&1}for(o=6;o>=0;o-=2){for(u=1;u<=25;u+=8)a<<=1,a|=t>>>u+o&1;for(u=1;u<=25;u+=8)a<<=1,a|=e>>>u+o&1}r[n+0]=i>>>0,r[n+1]=a>>>0},rip:function(e,t,r,n){for(var i=0,a=0,o=0;o<4;o++)for(var u=24;u>=0;u-=8)i<<=1,i|=t>>>u+o&1,i<<=1,i|=e>>>u+o&1;for(o=4;o<8;o++)for(u=24;u>=0;u-=8)a<<=1,a|=t>>>u+o&1,a<<=1,a|=e>>>u+o&1;r[n+0]=i>>>0,r[n+1]=a>>>0},pc1:function(e,t,r,n){for(var i=0,a=0,o=7;o>=5;o--){for(var u=0;u<=24;u+=8)i<<=1,i|=t>>u+o&1;for(u=0;u<=24;u+=8)i<<=1,i|=e>>u+o&1}for(u=0;u<=24;u+=8)i<<=1,i|=t>>u+o&1;for(o=1;o<=3;o++){for(u=0;u<=24;u+=8)a<<=1,a|=t>>u+o&1;for(u=0;u<=24;u+=8)a<<=1,a|=e>>u+o&1}for(u=0;u<=24;u+=8)a<<=1,a|=e>>u+o&1;r[n+0]=i>>>0,r[n+1]=a>>>0},r28shl:function(e,t){return e<<t&268435455|e>>>28-t},pc2:function(e,t,r,n){for(var i=0,a=0,o=Jr.length>>>1,u=0;u<o;u++)i<<=1,i|=e>>>Jr[u]&1;for(u=o;u<Jr.length;u++)a<<=1,a|=t>>>Jr[u]&1;r[n+0]=i>>>0,r[n+1]=a>>>0},expand:function(e,t,r){var n=0,i=0;n=(1&e)<<5|e>>>27;for(var a=23;a>=15;a-=4)n<<=6,n|=e>>>a&63;for(a=11;a>=3;a-=4)i|=e>>>a&63,i<<=6;i|=(31&e)<<1|e>>>31,t[r+0]=n>>>0,t[r+1]=i>>>0},substitute:function(e,t){for(var r=0,n=0;n<4;n++){r<<=4,r|=Mr[64*n+(e>>>18-6*n&63)]}for(n=0;n<4;n++){r<<=4,r|=Mr[256+64*n+(t>>>18-6*n&63)]}return r>>>0},permute:function(e){for(var t=0,r=0;r<Fr.length;r++)t<<=1,t|=e>>>Fr[r]&1;return t>>>0},padSplit:function(e,t,r){for(var n=e.toString(2);n.length<t;)n="0"+n;for(var i=[],a=0;a<t;a+=r)i.push(n.slice(a,a+r));return i.join(" ")}},Gr=qr;function qr(e,t){if(!e)throw new Error(t||"Assertion failed")}function Wr(e){this.options=e,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}qr.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)};var Zr=Wr;Wr.prototype._init=function(){},Wr.prototype.update=function(e){return 0===e.length?[]:"decrypt"===this.type?this._updateDecrypt(e):this._updateEncrypt(e)},Wr.prototype._buffer=function(e,t){for(var r=Math.min(this.buffer.length-this.bufferOff,e.length-t),n=0;n<r;n++)this.buffer[this.bufferOff+n]=e[t+n];return this.bufferOff+=r,r},Wr.prototype._flushBuffer=function(e,t){return this._update(this.buffer,0,e,t),this.bufferOff=0,this.blockSize},Wr.prototype._updateEncrypt=function(e){var t=0,r=0,n=(this.bufferOff+e.length)/this.blockSize|0,i=new Array(n*this.blockSize);0!==this.bufferOff&&(t+=this._buffer(e,t),this.bufferOff===this.buffer.length&&(r+=this._flushBuffer(i,r)));for(var a=e.length-(e.length-t)%this.blockSize;t<a;t+=this.blockSize)this._update(e,t,i,r),r+=this.blockSize;for(;t<e.length;t++,this.bufferOff++)this.buffer[this.bufferOff]=e[t];return i},Wr.prototype._updateDecrypt=function(e){for(var t=0,r=0,n=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,i=new Array(n*this.blockSize);n>0;n--)t+=this._buffer(e,t),r+=this._flushBuffer(i,r);return t+=this._buffer(e,t),i},Wr.prototype.final=function(e){var t,r;return e&&(t=this.update(e)),r="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),t?t.concat(r):r},Wr.prototype._pad=function(e,t){if(0===t)return!1;for(;t<e.length;)e[t++]=0;return!0},Wr.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e},Wr.prototype._unpad=function(e){return e},Wr.prototype._finalDecrypt=function(){Gr.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)};var $r="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},Xr=/%[sdj%]/g;function Yr(e){if(!fn(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(tn(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,a=String(e).replace(Xr,(function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),o=n[r];r<i;o=n[++r])ln(o)||!pn(o)?a+=" "+o:a+=" "+tn(o);return a}var Qr,en={};function tn(e,t){var r={seen:[],stylize:nn};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),cn(t)?r.showHidden=t:t&&Bn(r,t),vn(r.showHidden)&&(r.showHidden=!1),vn(r.depth)&&(r.depth=2),vn(r.colors)&&(r.colors=!1),vn(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=rn),an(r,e,r.depth)}function rn(e,t){var r=tn.styles[t];return r?"["+tn.colors[r][0]+"m"+e+"["+tn.colors[r][1]+"m":e}function nn(e,t){return e}function an(e,t,r){if(e.customInspect&&t&&dn(t.inspect)&&t.inspect!==tn&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return fn(n)||(n=an(e,n,r)),n}var i=function(e,t){if(vn(t))return e.stylize("undefined","undefined");if(fn(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(hn(t))return e.stylize(""+t,"number");if(cn(t))return e.stylize(""+t,"boolean");if(ln(t))return e.stylize("null","null")}(e,t);if(i)return i;var a=Object.keys(t),o=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),mn(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return on(t);if(0===a.length){if(dn(t)){var u=t.name?": "+t.name:"";return e.stylize("[Function"+u+"]","special")}if(yn(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(gn(t))return e.stylize(Date.prototype.toString.call(t),"date");if(mn(t))return on(t)}var s,c="",l=!1,h=["{","}"];(sn(t)&&(l=!0,h=["[","]"]),dn(t))&&(c=" [Function"+(t.name?": "+t.name:"")+"]");return yn(t)&&(c=" "+RegExp.prototype.toString.call(t)),gn(t)&&(c=" "+Date.prototype.toUTCString.call(t)),mn(t)&&(c=" "+on(t)),0!==a.length||l&&0!=t.length?r<0?yn(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),s=l?function(e,t,r,n,i){for(var a=[],o=0,u=t.length;o<u;++o)An(t,String(o))?a.push(un(e,t,r,n,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(un(e,t,r,n,i,!0))})),a}(e,t,r,o,a):a.map((function(n){return un(e,t,r,o,n,l)})),e.seen.pop(),function(e,t,r){if(e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(s,c,h)):h[0]+c+h[1]}function on(e){return"["+Error.prototype.toString.call(e)+"]"}function un(e,t,r,n,i,a){var o,u,s;if((s=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?u=s.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):s.set&&(u=e.stylize("[Setter]","special")),An(n,i)||(o="["+i+"]"),u||(e.seen.indexOf(s.value)<0?(u=ln(r)?an(e,s.value,null):an(e,s.value,r-1)).indexOf("\n")>-1&&(u=a?u.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+u.split("\n").map((function(e){return"   "+e})).join("\n")):u=e.stylize("[Circular]","special")),vn(o)){if(a&&i.match(/^\d+$/))return u;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+u}function sn(e){return Array.isArray(e)}function cn(e){return"boolean"==typeof e}function ln(e){return null===e}function hn(e){return"number"==typeof e}function fn(e){return"string"==typeof e}function vn(e){return void 0===e}function yn(e){return pn(e)&&"[object RegExp]"===kn(e)}function pn(e){return"object"===n(e)&&null!==e}function gn(e){return pn(e)&&"[object Date]"===kn(e)}function mn(e){return pn(e)&&("[object Error]"===kn(e)||e instanceof Error)}function dn(e){return"function"==typeof e}function kn(e){return Object.prototype.toString.call(e)}function wn(e){return e<10?"0"+e.toString(10):e.toString(10)}tn.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},tn.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var bn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Bn(e,t){if(!t||!pn(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}function An(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var xn={inherits:$r,_extend:Bn,log:function(){var e,t;console.log("%s - %s",(e=new Date,t=[wn(e.getHours()),wn(e.getMinutes()),wn(e.getSeconds())].join(":"),[e.getDate(),bn[e.getMonth()],t].join(" ")),Yr.apply(null,arguments))},isBuffer:function(e){return Buffer.isBuffer(e)},isPrimitive:function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===n(e)||void 0===e},isFunction:dn,isError:mn,isDate:gn,isObject:pn,isRegExp:yn,isUndefined:vn,isSymbol:function(e){return"symbol"===n(e)},isString:fn,isNumber:hn,isNullOrUndefined:function(e){return null==e},isNull:ln,isBoolean:cn,isArray:sn,inspect:tn,deprecate:function e(t,r){if(vn(global.process))return function(){return e(t,r).apply(this,arguments)};var n=!1;return function(){return n||(console.error(r),n=!0),t.apply(this,arguments)}},format:Yr,debuglog:function(e){if(vn(Qr)&&(Qr=""),e=e.toUpperCase(),!en[e])if(new RegExp("\\b"+e+"\\b","i").test(Qr)){en[e]=function(){var t=Yr.apply(null,arguments);console.error("%s %d: %s",e,0,t)}}else en[e]=function(){};return en[e]}},Sn=Q((function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}})),Cn=Q((function(e){try{var t=xn;if("function"!=typeof t.inherits)throw"";e.exports=t.inherits}catch(t){e.exports=Sn}}));function Rn(){this.tmp=new Array(2),this.keys=null}function Nn(e){Zr.call(this,e);var t=new Rn;this._desState=t,this.deriveKeys(t,e.key)}Cn(Nn,Zr);var En=Nn;Nn.create=function(e){return new Nn(e)};var Kn=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];Nn.prototype.deriveKeys=function(e,t){e.keys=new Array(32),Gr.equal(t.length,this.blockSize,"Invalid key length");var r=zr.readUInt32BE(t,0),n=zr.readUInt32BE(t,4);zr.pc1(r,n,e.tmp,0),r=e.tmp[0],n=e.tmp[1];for(var i=0;i<e.keys.length;i+=2){var a=Kn[i>>>1];r=zr.r28shl(r,a),n=zr.r28shl(n,a),zr.pc2(r,n,e.keys,i)}},Nn.prototype._update=function(e,t,r,n){var i=this._desState,a=zr.readUInt32BE(e,t),o=zr.readUInt32BE(e,t+4);zr.ip(a,o,i.tmp,0),a=i.tmp[0],o=i.tmp[1],"encrypt"===this.type?this._encrypt(i,a,o,i.tmp,0):this._decrypt(i,a,o,i.tmp,0),a=i.tmp[0],o=i.tmp[1],zr.writeUInt32BE(r,a,n),zr.writeUInt32BE(r,o,n+4)},Nn.prototype._pad=function(e,t){for(var r=e.length-t,n=t;n<e.length;n++)e[n]=r;return!0},Nn.prototype._unpad=function(e){for(var t=e[e.length-1],r=e.length-t;r<e.length;r++)Gr.equal(e[r],t);return e.slice(0,e.length-t)},Nn.prototype._encrypt=function(e,t,r,n,i){for(var a=t,o=r,u=0;u<e.keys.length;u+=2){var s=e.keys[u],c=e.keys[u+1];zr.expand(o,e.tmp,0),s^=e.tmp[0],c^=e.tmp[1];var l=zr.substitute(s,c),h=o;o=(a^zr.permute(l))>>>0,a=h}zr.rip(o,a,n,i)},Nn.prototype._decrypt=function(e,t,r,n,i){for(var a=r,o=t,u=e.keys.length-2;u>=0;u-=2){var s=e.keys[u],c=e.keys[u+1];zr.expand(a,e.tmp,0),s^=e.tmp[0],c^=e.tmp[1];var l=zr.substitute(s,c),h=a;a=(o^zr.permute(l))>>>0,o=h}zr.rip(a,o,n,i)};var On={};function Un(e){Gr.equal(e.length,8,"Invalid IV length"),this.iv=new Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}var Hn=function(e){function t(t){e.call(this,t),this._cbcInit()}Cn(t,e);for(var r=Object.keys(On),n=0;n<r.length;n++){var i=r[n];t.prototype[i]=On[i]}return t.create=function(e){return new t(e)},t};On._cbcInit=function(){var e=new Un(this.options.iv);this._cbcState=e},On._update=function(e,t,r,n){var i=this._cbcState,a=this.constructor.super_.prototype,o=i.iv;if("encrypt"===this.type){for(var u=0;u<this.blockSize;u++)o[u]^=e[t+u];a._update.call(this,o,0,r,n);for(u=0;u<this.blockSize;u++)o[u]=r[n+u]}else{a._update.call(this,e,t,r,n);for(u=0;u<this.blockSize;u++)r[n+u]^=o[u];for(u=0;u<this.blockSize;u++)o[u]=e[t+u]}};var Ln={instantiate:Hn};function Pn(e,t){Gr.equal(t.length,24,"Invalid key length");var r=t.slice(0,8),n=t.slice(8,16),i=t.slice(16,24);this.ciphers="encrypt"===e?[En.create({type:"encrypt",key:r}),En.create({type:"decrypt",key:n}),En.create({type:"encrypt",key:i})]:[En.create({type:"decrypt",key:i}),En.create({type:"encrypt",key:n}),En.create({type:"decrypt",key:r})]}function In(e){Zr.call(this,e);var t=new Pn(this.type,this.options.key);this._edeState=t}Cn(In,Zr);var Tn=In;In.create=function(e){return new In(e)},In.prototype._update=function(e,t,r,n){var i=this._edeState;i.ciphers[0]._update(e,t,r,n),i.ciphers[1]._update(r,n,r,n),i.ciphers[2]._update(r,n,r,n)},In.prototype._pad=En.prototype._pad,In.prototype._unpad=En.prototype._unpad;var Dn=zr,jn=Zr,_n=En,Vn=Ln,Jn=Tn,Mn={utils:Dn,Cipher:jn,DES:_n,CBC:Vn,EDE:Jn},Fn=Object.freeze({__proto__:null,default:Mn,__moduleExports:Mn,utils:Dn,Cipher:jn,DES:_n,CBC:Vn,EDE:Jn}),zn=function(e){function t(e,r,n,a){var o;return i(this,t),(o=p(this,h(t).call(this,e,r,"secret",n))).raw=a,o}return l(t,e),o(t,[{key:"toJSON",value:function(){return{kty:"oct",alg:this.getJwkAlgorithm(),k:B.ToBase64Url(this.raw),ext:this.extractable,key_ops:this.usages}}},{key:"getJwkAlgorithm",value:function(){switch(this.algorithm.name.toUpperCase()){case"DES-CBC":return"DES-CBC";case"DES-EDE3-CBC":return"3DES-CBC";default:throw new S("Unsupported algorithm name")}}}]),t}(fr),Gn=function(){function t(){i(this,t)}return o(t,null,[{key:"checkLib",value:function(){if(void 0===Fn)throw new R("Cannot implement DES mechanism. Add 'https://peculiarventures.github.io/pv-webcrypto-tests/src/des.js' script to your project")}},{key:"checkCryptoKey",value:function(e){if(!(e instanceof zn))throw new TypeError("key: Is not DesCryptoKey")}},{key:"generateKey",value:function(t,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkLib(),a=e.nativeCrypto.getRandomValues(new Uint8Array(t.length/8)),i.abrupt("return",new zn(t,r,n,a));case 3:case"end":return i.stop()}}),i,this)})))}},{key:"exportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this.checkLib(),r.t0=e,r.next="jwk"===r.t0?4:"raw"===r.t0?5:6;break;case 4:return r.abrupt("return",t.toJSON());case 5:return r.abrupt("return",t.raw.buffer);case 6:throw new R("format: Must be 'jwk' or 'raw'");case 7:case"end":return r.stop()}}),r,this)})))}},{key:"importKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkLib(),a=E(t)?B.FromBase64Url(t.k):A.toArrayBuffer(t),!("DES-CBC"===r.name&&8!==a.byteLength||"DES-EDE3-CBC"===r.name&&24!==a.byteLength)){e.next=4;break}throw new R("keyData: Is wrong key length");case 4:return o=new zn({name:r.name,length:a.byteLength<<3},n,i,new Uint8Array(a)),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"encrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r,!0));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"decrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.cipher(e,t,r,!1));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"cipher",value:function(e,t,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o,u,s;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:this.checkLib(),a=n?"encrypt":"decrypt",u=A.toUint8Array(e.iv),i.t0=e.name.toUpperCase(),i.next="DES-CBC"===i.t0?6:"DES-EDE3-CBC"===i.t0?8:10;break;case 6:return o=Vn.instantiate(_n).create({key:t.raw,type:a,iv:u}),i.abrupt("break",11);case 8:return o=Vn.instantiate(Jn).create({key:t.raw,type:a,iv:u}),i.abrupt("break",11);case 10:throw new R("algorithm: Is not recognized");case 11:return s=o.update(new Uint8Array(r)).concat(o.final()),i.abrupt("return",new Uint8Array(s).buffer);case 13:case"end":return i.stop()}}),i,this)})))}}]),t}(),qn=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).keySizeBits=64,e.ivSize=8,e.name="DES-CBC",e}return l(t,e),o(t,[{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Gn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Gn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Gn.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onEncrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Gn.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Gn.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,r){g(h(t.prototype),"checkCryptoKey",this).call(this,e,r),Gn.checkCryptoKey(e)}}]),t}(T),Wn=function(e){function t(){var e;return i(this,t),(e=p(this,h(t).apply(this,arguments))).keySizeBits=192,e.ivSize=8,e.name="DES-EDE3-CBC",e}return l(t,e),o(t,[{key:"onGenerateKey",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Gn.generateKey(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Gn.exportKey(e,t));case 1:case"end":return r.stop()}}),r)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Gn.importKey(e,t,r,n,i));case 1:case"end":return a.stop()}}),a)})))}},{key:"onEncrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Gn.encrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"onDecrypt",value:function(e,t,r){return Y(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Gn.decrypt(e,t,r));case 1:case"end":return n.stop()}}),n)})))}},{key:"checkCryptoKey",value:function(e,r){g(h(t.prototype),"checkCryptoKey",this).call(this,e,r),Gn.checkCryptoKey(e)}}]),t}(T),Zn=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"HMAC"},n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Uint8Array(0);return i(this,t),(e=p(this,h(t).call(this,r,n,"secret",a))).kty="oct",e.data=o,e}return l(t,e),o(t,[{key:"alg",get:function(){var e=this.algorithm.hash.name.toUpperCase();return"HS".concat(e.replace("SHA-",""))},set:function(e){}}]),t}(fr);X([$t({name:"ext",type:Et.Boolean,optional:!0})],Zn.prototype,"extractable",void 0),X([$t({name:"key_ops",type:Et.String,repeated:!0,optional:!0})],Zn.prototype,"usages",void 0),X([$t({name:"k",converter:rr})],Zn.prototype,"data",void 0),X([$t({type:Et.String})],Zn.prototype,"kty",void 0),X([$t({type:Et.String})],Zn.prototype,"alg",null);var $n=function(r){function n(){return i(this,n),p(this,h(n).apply(this,arguments))}return l(n,r),o(n,[{key:"onGenerateKey",value:function(t,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,o,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=t.length||this.getDefaultLength(t.hash.name),o=e.nativeCrypto.getRandomValues(new Uint8Array(a>>3)),u=new Zn(t,r,n,o),i.abrupt("return",u);case 4:case"end":return i.stop()}}),i,this)})))}},{key:"onSign",value:function(e,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r.algorithm.hash.name.toUpperCase(),e.next="SHA-1"===e.t0?3:"SHA-256"===e.t0?5:"SHA-512"===e.t0?7:9;break;case 3:return i=t.HmacSha1,e.abrupt("break",10);case 5:return i=t.HmacSha256,e.abrupt("break",10);case 7:return i=t.HmacSha512,e.abrupt("break",10);case 9:throw new R("key.algorithm.hash: Is not recognized");case 10:return a=new i(r.data).process(A.toUint8Array(n)).finish().result,e.abrupt("return",A.toArrayBuffer(a));case 12:case"end":return e.stop()}}),e)})))}},{key:"onVerify",value:function(e,t,r,n){return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.onSign(e,t,n);case 2:return a=i.sent,i.abrupt("return",B.ToHex(a)===B.ToHex(r));case 4:case"end":return i.stop()}}),i,this)})))}},{key:"onImportKey",value:function(e,t,r,n,i){return Y(this,void 0,void 0,regeneratorRuntime.mark((function a(){var o;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.t0=e.toLowerCase(),a.next="jwk"===a.t0?3:"raw"===a.t0?5:9;break;case 3:return o=Wt.fromJSON(t,{targetSchema:Zn}),a.abrupt("break",10);case 5:if(A.isBufferSource(t)){a.next=7;break}throw new TypeError("keyData: Is not ArrayBuffer or ArrayBufferView");case 7:return o=new Zn(r,n,i,A.toUint8Array(t)),a.abrupt("break",10);case 9:throw new R("format: Must be 'jwk' or 'raw'");case 10:return o.algorithm={hash:{name:r.hash.name},name:this.name,length:o.data.length<<3},o.extractable=n,o.usages=i,a.abrupt("return",o);case 14:case"end":return a.stop()}}),a,this)})))}},{key:"onExportKey",value:function(e,t){return Y(this,void 0,void 0,regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e.toLowerCase(),r.next="jwk"===r.t0?3:"raw"===r.t0?5:6;break;case 3:return n=qt.toJSON(t),r.abrupt("return",n);case 5:return r.abrupt("return",new Uint8Array(t.data).buffer);case 6:throw new R("format: Must be 'jwk' or 'raw'");case 7:case"end":return r.stop()}}),r)})))}},{key:"checkCryptoKey",value:function(e,t){if(g(h(n.prototype),"checkCryptoKey",this).call(this,e,t),!(e instanceof Zn))throw new TypeError("key: Is not HMAC CryptoKey")}}]),n}(q),Xn=function(e){function t(e,r,n,a,o){var u;return i(this,t),(u=p(this,h(t).call(this,e,r,n,a))).nativeKey=o,u}return l(t,e),t}(fr),Yn=function(t){function r(){var e;return i(this,r),(e=p(this,h(r).call(this))).browserInfo=function(){var e={name:tr.Unknown,version:"0"};if("undefined"==typeof self)return e;var t,r=self.navigator.userAgent;return(t=/edge\/([\d\.]+)/i.exec(r))?(e.name=tr.Edge,e.version=t[1]):/msie/i.test(r)?(e.name=tr.IE,e.version=/msie ([\d\.]+)/i.exec(r)[1]):/Trident/i.test(r)?(e.name=tr.IE,e.version=/rv:([\d\.]+)/i.exec(r)[1]):/chrome/i.test(r)?(e.name=tr.Chrome,e.version=/chrome\/([\d\.]+)/i.exec(r)[1]):/firefox/i.test(r)?(e.name=tr.Firefox,e.version=/firefox\/([\d\.]+)/i.exec(r)[1]):/mobile/i.test(r)?(e.name=tr.Mobile,e.version=/mobile\/([\w]+)/i.exec(r)[1]):/safari/i.test(r)&&(e.name=tr.Safari,e.version=/version\/([\d\.]+)/i.exec(r)[1]),e}(),e.providers.set(new gr),e.providers.set(new kr),e.providers.set(new mr),e.providers.set(new dr),e.providers.set(new wr),e.providers.set(new qn),e.providers.set(new Wn),e.providers.set(new Cr),e.providers.set(new Sr),e.providers.set(new xr),e.providers.set(new Rr),e.providers.set(new Ir),e.providers.set(new Ur),e.providers.set(new Tr),e.providers.set(new Dr),e.providers.set(new jr),e.providers.set(new Vr),e.providers.set(new $n),e}return l(r,t),o(r,[{key:"digest",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["digest"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"importKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.fixFirefoxEcImportPkcs8(t),e.abrupt("return",this.wrapNative.apply(this,["importKey"].concat(t)));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"exportKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fixFirefoxEcExportPkcs8(t);case 2:if(e.t0=e.sent,e.t0){e.next=7;break}return e.next=6,this.wrapNative.apply(this,["exportKey"].concat(t));case 6:e.t0=e.sent;case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"generateKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["generateKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"sign",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["sign"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"verify",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["verify"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"encrypt",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["encrypt"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"decrypt",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["decrypt"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"wrapKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["wrapKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"unwrapKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["unwrapKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"deriveBits",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["deriveBits"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"deriveKey",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Y(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.wrapNative.apply(this,["deriveKey"].concat(t)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"wrapNative",value:function(t){for(var i=this,a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];var s=function(e){return g(h(r.prototype),e,i)};return Y(this,void 0,void 0,regeneratorRuntime.mark((function i(){var a,u,c,l,h,f,v,y,p,g,m,d,k,w,b,A,x,S;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(~["generateKey","unwrapKey","deriveKey","importKey"].indexOf(t)&&this.fixAlgorithmName(o),i.prev=1,"digest"===t&&o.some((function(e){return e instanceof fr}))){i.next=9;break}return a=this.fixNativeArguments(t,o),hr.info("Call native '".concat(t,"' method"),a),i.next=7,e.nativeSubtle[t].apply(e.nativeSubtle,a);case 7:return u=i.sent,i.abrupt("return",this.fixNativeResult(t,o,u));case 9:i.next=14;break;case 11:i.prev=11,i.t0=i.catch(1),hr.warn("Error on native '".concat(t,"' calling. ").concat(i.t0.message),i.t0);case 14:if("wrapKey"!==t){i.next=30;break}return i.prev=15,hr.info("Trying to wrap key by using native functions",o),i.next=19,this.exportKey(o[0],o[1]);case 19:return c=i.sent,l="jwk"===o[0]?B.FromUtf8String(JSON.stringify(c)):c,i.next=23,this.encrypt(o[3],o[2],l);case 23:return h=i.sent,i.abrupt("return",h);case 27:i.prev=27,i.t1=i.catch(15),hr.warn("Cannot wrap key by native functions. ".concat(i.t1.message),i.t1);case 30:if("unwrapKey"!==t){i.next=46;break}return i.prev=31,hr.info("Trying to unwrap key by using native functions",o),i.next=35,this.decrypt(o[3],o[2],o[1]);case 35:return f=i.sent,v="jwk"===o[0]?JSON.parse(B.ToUtf8String(f)):f,i.next=39,this.importKey(o[0],v,o[4],o[5],o[6]);case 39:return y=i.sent,i.abrupt("return",y);case 43:i.prev=43,i.t2=i.catch(31),hr.warn("Cannot unwrap key by native functions. ".concat(i.t2.message),i.t2);case 46:if("deriveKey"!==t){i.next=61;break}return i.prev=47,hr.info("Trying to derive key by using native functions",o),i.next=51,this.deriveBits(o[0],o[1],o[2].length);case 51:return p=i.sent,i.next=54,this.importKey("raw",p,o[2],o[3],o[4]);case 54:return g=i.sent,i.abrupt("return",g);case 58:i.prev=58,i.t3=i.catch(47),hr.warn("Cannot derive key by native functions. ".concat(i.t3.message),i.t3);case 61:if("deriveBits"!==t&&"deriveKey"!==t){i.next=90;break}m=!0,d=!1,k=void 0,i.prev=65,w=o[Symbol.iterator]();case 67:if(m=(b=w.next()).done){i.next=76;break}if("object"!==n(A=b.value)||!A.public||!r.isAnotherKey(A.public)){i.next=73;break}return i.next=72,this.castKey(A.public);case 72:A.public=i.sent;case 73:m=!0,i.next=67;break;case 76:i.next=82;break;case 78:i.prev=78,i.t4=i.catch(65),d=!0,k=i.t4;case 82:i.prev=82,i.prev=83,m||null==w.return||w.return();case 85:if(i.prev=85,!d){i.next=88;break}throw k;case 88:return i.finish(85);case 89:return i.finish(82);case 90:x=0;case 91:if(!(x<o.length)){i.next=100;break}if(S=o[x],!r.isAnotherKey(S)){i.next=97;break}return i.next=96,this.castKey(S);case 96:o[x]=i.sent;case 97:x++,i.next=91;break;case 100:return i.abrupt("return",s(t).apply(this,o));case 101:case"end":return i.stop()}}),i,this,[[1,11],[15,27],[31,43],[47,58],[65,78,82,90],[83,,85,89]])})))}},{key:"fixNativeArguments",value:function(e,t){var r,n,i,a,o,u,s,c,l,h=m(t);if("importKey"===e&&("jwk"!==(null===(i=null===(r=h[0])||void 0===r?void 0:(n=r).toLowerCase)||void 0===i?void 0:i.call(n))||A.isBufferSource(h[1])||(h[1]=B.FromUtf8String(JSON.stringify(h[1])))),this.browserInfo.name===tr.IE&&t[1]instanceof Xn)switch(e){case"sign":case"verify":case"encrypt":case"decrypt":h[0]=Object.assign(Object.assign({},this.prepareAlgorithm(h[0])),{hash:null===(u=null===(o=null===(a=h[1])||void 0===a?void 0:a.algorithm)||void 0===o?void 0:o.hash)||void 0===u?void 0:u.name});break;case"wrapKey":case"unwrapKey":h[4]=Object.assign(Object.assign({},this.prepareAlgorithm(h[4])),{hash:null===(l=null===(c=null===(s=h[3])||void 0===s?void 0:s.algorithm)||void 0===c?void 0:c.hash)||void 0===l?void 0:l.name})}for(var f=0;f<h.length;f++){var v=h[f];v instanceof Xn&&(h[f]=v.nativeKey)}return h}},{key:"fixNativeResult",value:function(e,t,r){var n,i,a;if("exportKey"===e&&"jwk"===(null===(a=null===(n=t[0])||void 0===n?void 0:(i=n).toLowerCase)||void 0===a?void 0:a.call(i))&&r instanceof ArrayBuffer)return JSON.parse(B.ToUtf8String(r));if(this.browserInfo.name===tr.IE){if("privateKey"in r){var o=["sign","decrypt","unwrapKey","deriveKey","deriveBits"],u=["verify","encrypt","wrapKey"];return{privateKey:this.wrapNativeKey(r.privateKey,t[0],t[1],t[2].filter((function(e){return o.includes(e)}))),publicKey:this.wrapNativeKey(r.publicKey,t[0],t[1],t[2].filter((function(e){return u.includes(e)})))}}if("extractable"in r)return this.wrapNativeKey(r,"importKey"===e?t[2]:t[4],r.extractable,"importKey"===e?t[4]:t[6])}return r}},{key:"wrapNativeKey",value:function(e,t,r,n){if(this.browserInfo.name===tr.IE){var i=["RSASSA-PKCS1-v1_5","RSA-PSS","RSA-OAEP"],a=i.map((function(e){return e.toLowerCase()})).indexOf(e.algorithm.name.toLowerCase());if(-1!==a){var o=this.prepareAlgorithm(t);if($.isHashedAlgorithm(o)){var u=Object.assign(Object.assign(Object.assign({},e.algorithm),o),{name:i[a]});return new Xn(u,r,e.type,n,e)}}}return e}},{key:"castKey",value:function(e){return Y(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(hr.info("Cast native CryptoKey to linter key.",e),e.extractable){t.next=3;break}throw new Error("Cannot cast unextractable crypto key");case 3:return r=this.getProvider(e.algorithm.name),t.next=6,this.exportKey("jwk",e);case 6:return n=t.sent,t.abrupt("return",r.importKey("jwk",n,e.algorithm,!0,e.usages));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"fixAlgorithmName",value:function(e){if(this.browserInfo.name===tr.Edge)for(var t=0;t<e.length;t++){var r=e[0];if("string"==typeof r){var i=!0,a=!1,o=void 0;try{for(var u,s=this.providers.algorithms[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value;if(c.toLowerCase()===r.toLowerCase()){e[t]=c;break}}}catch(e){a=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw o}}}else if("object"===n(r)&&"string"==typeof r.name){var l=!0,h=!1,f=void 0;try{for(var v,y=this.providers.algorithms[Symbol.iterator]();!(l=(v=y.next()).done);l=!0){var p=v.value;p.toLowerCase()===r.name.toLowerCase()&&(r.name=p),("string"==typeof r.hash&&p.toLowerCase()===r.hash.toLowerCase()||"object"===n(r.hash)&&"string"==typeof r.hash.name&&p.toLowerCase()===r.hash.name.toLowerCase())&&(r.hash={name:p})}}catch(e){h=!0,f=e}finally{try{l||null==y.return||y.return()}finally{if(h)throw f}}}}}},{key:"fixFirefoxEcImportPkcs8",value:function(e){var t=this.prepareAlgorithm(e[2]),r=t.name.toUpperCase();if(this.browserInfo.name===tr.Firefox&&"pkcs8"===e[0]&&~["ECDSA","ECDH"].indexOf(r)&&~["P-256","P-384","P-521"].indexOf(t.namedCurve)){if(!A.isBufferSource(e[1]))throw new TypeError("data: Is not ArrayBuffer or ArrayBufferView");var n=A.toArrayBuffer(e[1]),i=Kt.parse(n,Qt),a=Kt.parse(i.privateKey,sr),o=qt.toJSON(a);o.ext=!0,o.key_ops=e[4],o.crv=t.namedCurve,o.kty="EC",e[0]="jwk",e[1]=o}}},{key:"fixFirefoxEcExportPkcs8",value:function(e){return Y(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.browserInfo.name!==tr.Firefox||"pkcs8"!==e[0]||!~["ECDSA","ECDH"].indexOf(e[1].algorithm.name)||!~["P-256","P-384","P-521"].indexOf(e[1].algorithm.namedCurve)){t.next=11;break}return t.next=4,this.exportKey("jwk",e[1]);case 4:return r=t.sent,n=Wt.fromJSON(r,{targetSchema:sr}),(i=new Qt).privateKeyAlgorithm.algorithm=Or.ASN_ALGORITHM,i.privateKeyAlgorithm.parameters=Ot.serialize(new Xt(Er(e[1].algorithm.namedCurve))),i.privateKey=Ot.serialize(n),t.abrupt("return",Ot.serialize(i));case 11:t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(0),hr.error(t.t0),t.abrupt("return",null);case 17:case"end":return t.stop()}}),t,this,[[0,13]])})))}}],[{key:"isAnotherKey",value:function(e){return"object"===n(e)&&"string"==typeof e.type&&"boolean"==typeof e.extractable&&"object"===n(e.algorithm)&&!(e instanceof fr)}}]),r}($);Yn.methods=["digest","importKey","exportKey","sign","verify","generateKey","encrypt","decrypt","deriveBits","deriveKey","wrapKey","unwrapKey"];var Qn=function(t){function r(){var e;return i(this,r),(e=p(this,h(r).apply(this,arguments))).subtle=new Yn,e}return l(r,t),o(r,[{key:"getRandomValues",value:function(t){return e.nativeCrypto.getRandomValues(t)}},{key:"nativeCrypto",get:function(){return e.nativeCrypto}}]),r}((function e(){i(this,e)}));function ei(e,t){var r=e[t];e[t]=function(){var n=arguments;return new Promise((function(i,a){var o=r.apply(e,n);o.oncomplete=function(e){i(e.target.result)},o.onerror=function(e){a("Error on running '".concat(t,"' function"))}}))}}"undefined"!=typeof self&&self.msCrypto&&(ei(e.nativeSubtle,"generateKey"),ei(e.nativeSubtle,"digest"),ei(e.nativeSubtle,"sign"),ei(e.nativeSubtle,"verify"),ei(e.nativeSubtle,"encrypt"),ei(e.nativeSubtle,"decrypt"),ei(e.nativeSubtle,"importKey"),ei(e.nativeSubtle,"exportKey"),ei(e.nativeSubtle,"wrapKey"),ei(e.nativeSubtle,"unwrapKey"),ei(e.nativeSubtle,"deriveKey"),ei(e.nativeSubtle,"deriveBits")),Math.imul||(Math.imul=function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0});var ti=self;e.nativeCrypto&&Object.freeze(e.nativeCrypto.getRandomValues);try{delete self.crypto,ti.crypto=new Qn,Object.freeze(ti.crypto)}catch(e){hr.error(e)}var ri=ti.crypto;return e.Crypto=Qn,e.CryptoKey=fr,e.crypto=ri,e.setCrypto=function(t){e.nativeCrypto=t,e.nativeSubtle=t.subtle},e}({},self.asmCrypto,self.elliptic);
